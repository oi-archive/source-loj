{"title":"「PKUSC2018」星际穿越","time_limit":1000,"memory_limit":512,"tags":[],"operation":{"submit":"https://loj.ac/problem/6435#submit_code","submissions":"https://loj.ac/submissions?problem_id=6435","statistics":"https://loj.ac/problem/6435/statistics/fastest","testdata":"https://loj.ac/problem/6435/testdata","discussion":"https://loj.ac/discussion/problem/6435"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"有 $n$ 个星球，它们的编号是 $1$ 到 $n$，它们坐落在同一个星系内，这个星系可以抽象为一条数轴，每个星球都是数轴上的一个点，特别地，编号为 $i$ 的星球的坐标是 $i$。\r\n\r\n一开始，由于科技上的原因，这 $n$ 个星球的居民之间无法进行交流，因此他们也不知道彼此的存在。现在，这些星球独立发展出了星际穿越与星际交流的工具。对于第 $i$ 个星球，他通过发射强力信号，成功地与编号在 $[l_i,i-1]$ 的所有星球取得了联系(编号为 1 的星球没有发出任何信号)，取得联系的两个星球会建立 **双向** 的传送门，对于建立了传送门的两个星球 $u,v$，$u$ 上的居民可以花费 1 单位时间传送到 $v$，$v$ 上的居民也可以花费 1 单位时间传送到 $u$ ，我们用 $dist(x,y)$ 表示从编号为 $x$ 的星球出发，通过一系列星球间的传送门，传送到编号为 $y$ 的星球最少需要花费的时间。\r\n\r\n现在有 $q$ 个星际商人，第 $i$ 个商人初始所在的位置是 $x_i$, 他的目的地是 $[l_i,r_i]$ 中的其中一个星球，保证 $l_i<r_i<x_i$ 。他会在这些星球中等概率挑选一个星球 $y$ (每个星球都有一样的概率被选中作为目的地)，然后通过一系列星球的传送门，**花费最少的时间**到达星球 $y$ 。商人想知道他花费的期望时间是多少？也就是计算 $\\frac{1}{r_i-l_i+1}{\\sum_{y=l_i}^{r_i}{dist(x_i,y)}}$ 。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行一个正整数 $n$ ，表示星球的个数。\r\n\r\n第二行 $n-1$ 个正整数，第 $i$ 个正整数为  $l_{i+1}$ ，表示编号在 $[l_{i+1},i]$ 区间内所有星球已经与编号为 $i+1$ 的星球取得了联系，并且可以通过花费 1 单位进行彼此的传输。保证 $l_{i+1}\\leq i$\r\n\r\n第三行一个正整数 $q$ ，表示询问组数。\r\n\r\n接下来 $q$ 行，每行三个数字 $l_i,r_i,x_i$ ，表示在 $[l_i,r_i]$ 这个区间中等概率选择一个星球 $y$，$dist(x_i,y)$ 的期望。保证 $l_i<r_i<x_i$"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于每组询问，注意到答案必然是一个有理数，因此以 $p/q$ 的格式输出这个有理数，要求 $gcd(p,q)=1$ 。\r\n\r\n如果答案为整数 $m$ ，输出 $m/1$ 。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n7\r\n1 1 2 1 4 6\r\n5\r\n3 4 6\r\n1 5 7\r\n1 2 4\r\n1 2 6\r\n1 3 5\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n3/2\r\n13/5\r\n3/2\r\n2/1\r\n1/1\r\n```\r\n\r\n#### 样例解释\r\n\r\n样例对应的无向图如下：<img src=\"https://i.loli.net/2018/06/05/5b163dc470f59.png\" width=768 height=256 />"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于 $20\\%$ 的数据，满足 $n \\leq 100$。\r\n\r\n对于另 $25\\%$ 的数据，满足 $n\\leq 2000$\r\n\r\n对于另 $25\\%$ 的数据，满足 $n\\leq 5000$\r\n\r\n对于 $100\\%$ 的数据，满足 $n,q\\leq 3\\times 10^5$"}]}