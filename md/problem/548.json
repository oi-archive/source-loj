{"title":"「LibreOJ β Round #7」某少女附中的体育课","time_limit":1000,"memory_limit":512,"tags":["LibreOJ β Round","DFT（含 NTT）及FFT","FWT","数学","映射与反演"],"operation":{"submit":"https://loj.ac/problem/548#submit_code","submissions":"https://loj.ac/submissions?problem_id=548","statistics":"https://loj.ac/problem/548/statistics/fastest","testdata":"https://loj.ac/problem/548/testdata","discussion":"https://loj.ac/discussion/problem/548"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"> 神犇是某少女附中的高三生。在机房的窗边，神犇和 LCR 一起俯瞰着楼下玩篮球的学生。注视着他们的背影，神犇想起了高一时的一件往事 ……\r\n\r\n当时，他的体育老师每节体育课都让同学们玩传球游戏，玩法是这样的：\r\n\r\n体育老师有 $n$ 个篮球。一开始，体育老师会把所有学生平均分为 $n$ 组，每组 $m$ 人。组的编号为 $0,1,\\cdots,n-1$，每组中学生分别编号为 $0,1,\\cdots,m-1$。为了方便描述，我们定义 $S$ 为 $[0,m)$ 中的整数集合。\r\n\r\n接着，体育老师会使用他手机上的计算器生成一个长为 $n$ 的每个元素属于 $S$ 的伪随机数列 $\\{s_i\\}$。接着对于第 $i$ 组他把球发给该组的 $s_i$ 号学生。\r\n\r\n然后体育老师会发给学生一个 $m\\times m$ 的表 $A$ 表示传球规则，其中的数都属于 $S$，且 $A$ 有一些特殊性质。为了方便描述 $A$，我们定义 $S$ 上的二元运算 $\\circ:i\\circ j=A_{i,j}$。另外定义 $ i^j = \\begin{gather}\\underbrace{i\\circ i\\circ \\cdots \\circ i}\\\\ j \\text{ times} \\end{gather} $。  \r\n$A$ 满足的性质如下：\r\n* 交换律，即 $\\forall i,j \\in S,i\\circ j=j\\circ i$\r\n* 结合律，即 $\\forall i,j,k \\in S,(i\\circ j)\\circ k=i\\circ (j \\circ k)$\r\n* 循环律，即 $\\forall i\\in S,\\exists j>1$ 使得 $i^j=i$\r\n\r\n然后体育老师会让学生进行 $k$ 轮传球。每一轮传球的方法相同，如下：\r\n* 首先体育老师会使用他手机上的计算器生成一个长为 $n$ 的每个元素属于 $S$ 的伪随机数列 $\\{s_i\\}$。\r\n* 对于第 $i$ 组学生，如果当前球在组内编号为 $a_i$ 的学生手上，那么他会把球传给组内 $a_i\\circ s_i$ 号学生（当 $a_i = a_i\\circ s_i$ 时不传球）。\r\n\r\n为了方便，我们用一个 $n$ 位 $m$ 进制数来表示一个长为 $n$，下标从 $0$ 开始，每个位置元素属于 $S$ 的数列。具体地，我们用 $\\sum_{i=0}^n s_i m^i$ 来表示 $\\{s_i\\}$。显然，$[0,m^n)$ 中的整数与所有可能的该种数列一一对应。\r\n\r\n神犇记得，体育老师手机里的随机数生成器生成的每组随机数的 $m^n$ 种结果并不是等可能的（但同一节课内每次使用时生成各结果的概率不变）。我们用一个长 $m^n$ 的序列 $\\{P_i\\}$ 表示每种结果的概率，设 $X=\\sum_{i=0}^{m^n-1} P_i$，则生成 $i$ 对应的数列的概率为 $\\frac{P_i}{X}$。\r\n\r\n神犇把这些往事告诉了 LCR。LCR 想知道 $k$ 轮传球后球的持有者的每种情况的概率。于是她希望你 —— 某少女附中著名 OIer —— 来解决这个问题。\r\n\r\n设最终编号为 $i$ 的组中篮球在 $r_i$ 号学生手中，那么用 $\\{r_i\\}$ 对应的 $m$ 进制数来表示这个状态。为了简化计算及避免精度误差，我们只需要求出对于 $[0,m^n)$ 中的每个数 $i$，$i$ 所对应的状态的概率与 $X^{k+1}$ 的乘积模 $232792561$ 的值。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行三个整数 $n,m,k$。  \r\n接下来 $m$ 行每行 $m$ 个整数，表示 $A$。其中第 $i+1$ 行第 $j+1$ 个整数表示 $A_{i,j}$。  \r\n接下来一行 $m^n$ 个整数，其中第 $i+1$ 个整数表示 $P_i$。\r\n"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出 $m^n$ 行，**每行一个整数**，其中第 $i+1$ 行表示 $k$ 次传球过后处于 $i$ 所对应的状态的概率与 $X^{k+1}$ 的乘积模 $232792561$ 的值。\r\n"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n2 2 1\r\n0 1\r\n1 0\r\n3 2 4 1\r\n```\r\n\r\n#### 样例输出 1\r\n```plain\r\n30\r\n20\r\n28\r\n22\r\n```\r\n\r\n#### 样例解释 1\r\n\r\n**$A=\\begin{bmatrix}0 & 1\\\\1 & 0\\end{bmatrix}$，故此组数据中由状态和传球方法得出的传球结果即为二者二进制按位异或的结果。**\r\n\r\n下面是详细说明：\r\n\r\n$0$ 对应的数列是 $\\{0,0\\}$，对应的状态是：两组的球都在组内 $0$ 号学生手中；  \r\n$1$ 对应的数列是 $\\{1,0\\}$，对应的状态是：第 $0$ 组的球都在组内 $1$ 号学生手中，第 $1$ 组的球在组内 $0$ 号学生手中；  \r\n$2$ 对应的数列是 $\\{0,1\\}$，对应的状态是：第 $0$ 组的球都在组内 $0$ 号学生手中，第 $1$ 组的球在组内 $1$ 号学生手中；  \r\n$3$ 对应的数列是 $\\{1,1\\}$，对应的状态是：两组的球都在组内 $1$ 号学生手中。\r\n\r\n开始时，$0$ 到 $3$ 对应的状态的概率依次为：$0.3, 0.2, 0.4, 0.1$。\r\n\r\n第一轮传球时，生成数列 $\\{0,0\\}$ 的概率为 $0.3$，若生成了 $\\{0,0\\}$，且当前状态为 $0$（即两组的球都在 $0$ 号学生手中），那么，计算传球情况的过程如下：\r\n\r\n* 已知，当前状态每组持球学生的编号数列 $\\{a_i\\}$ 为 $\\{0,0\\}$，生成的传球数列 $\\{s_i\\}$ 也是 $\\{0,0\\}$；求传球后的每组持球学生编号数列 $\\{b_i\\}$。\r\n* 传球方法表 $A=\\begin{bmatrix}0 & 1\\\\1 & 0\\end{bmatrix}$。\r\n* 则对于任意 $i$ 有 $b_i=A_{a_i,s_i}$，具体地，$b_0=A_{0,0}=0,b_1=A_{0,0}=0$。\r\n\r\n那么，传球后每组持球学生编号依次为 $0,0$，对应的数为 $0$。\r\n\r\n我们再看一组：第一轮传球时，生成数列 $\\{1,0\\}$ 的概率为 $0.2$，若生成了 $\\{1,0\\}$，且当前状态为 $3$（即两组的球都在 $1$ 号学生手中），那么：  \r\n当前状态每组持球学生的编号数列 $\\{a_i\\}$ 为 $\\{1,1\\}$，生成的传球数列 $\\{s_i\\}$ 是 $\\{1,0\\}$，可以计算出传球后的每组持球学生编号数列 $\\{b_i\\}$ 为：$b_0=A_{1,1}=0,b_1=A_{1,0}=1$。  \r\n那么，传球后每组持球学生编号依次为 $0,1$，对应的数为 $2$。\r\n\r\n以下是所有可能的情况：（行表示传球前状态，列表示传球数列，格内为传球结果，以「状态，概率」格式表示）\r\n\r\n|#|$0,0.3$|$1,0.2$|$2,0.4$|$3,0.1$|\r\n|:-:|:-:|:-:|:-:|:-:|\r\n|$0,0.3$|$0,0.09$|$1,0.06$|$2,0.12$|$3,0.03$|\r\n|$1,0.2$|$1,0.06$|$0,0.04$|$3,0.08$|$2,0.02$|\r\n|$2,0.4$|$2,0.12$|$3,0.08$|$0,0.16$|$1,0.04$|\r\n|$3,0.1$|$3,0.03$|$2,0.02$|$1,0.04$|$0,0.01$|\r\n\r\n最终，$0$ 到 $3$ 对应的状态的概率依次为：$0.09+0.04+0.16+0.01=0.3,0.06+0.06+0.04+0.04=0.2,0.12+0.02+0.12+0.02=0.28,0.03+0.08+0.08+0.03=0.22$，又 $X=3+2+4+1=10$，故分别乘 $X^{k+1}=10^2=100$ 即得输出。\r\n\r\n#### 样例输入 2\r\n```plain\r\n3 2 2\r\n0 1\r\n1 0\r\n1 2 1 2 1 0 0 3\r\n```\r\n\r\n#### 样例输出 2\r\n```plain\r\n118\r\n134\r\n118\r\n134\r\n130\r\n114\r\n102\r\n150\r\n```\r\n\r\n#### 样例解释 2\r\n最开始 $0$ 到 $7$ 对应的状态的概率依次为：$0.1, 0.2, 0.1, 0.2, 0.1, 0, 0, 0.3$；  \r\n传球一轮后的概率依次为：$0.2, 0.08, 0.1, 0.14, 0.14, 0.1, 0.14, 0.1$；  \r\n传球两轮后的概率依次为：$0.118, 0.134, 0.118, 0.134, 0.13, 0.114, 0.102, 0.15$。\r\n\r\n#### 样例输入 3\r\n```plain\r\n3 3 1000000000000000000\r\n0 1 0\r\n1 0 1\r\n0 1 2\r\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27\r\n```\r\n\r\n#### 样例输出 3\r\n```plain\r\n213274696\r\n208936145\r\n25902863\r\n95562855\r\n217079278\r\n63925718\r\n106613073\r\n183344989\r\n8375316\r\n32956358\r\n199136079\r\n5516750\r\n230547873\r\n170961061\r\n216818160\r\n114420143\r\n15437393\r\n149522201\r\n77102517\r\n62329524\r\n215121795\r\n51813646\r\n230286755\r\n91113233\r\n13573868\r\n80597355\r\n39406187\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有数据，$1\\le n\\le 18,2\\le m\\le 22,1\\le k\\le 10^{18},m^n\\le 5\\times 10^5 ,0\\le P_i < 232792561$。\r\n\r\n详细的数据限制及约定如下（留空表示和上述所有数据的约定相同）：\r\n\r\n|Subtask #|分值|$m$|$n$|$k$|特殊限制|\r\n|:-:|:-:|:-:|:-:|:-:|:-:|\r\n|$1$|$7$|$=2$|$\\le 10$|$\\le 10$|-|\r\n|$2$|$8$|$=2$|-|$\\le 10$|$A=\\begin{bmatrix}1 & 0\\\\0 & 1\\end{bmatrix}$|\r\n|$3$|$10$|$=2$|-|-|-|\r\n|$4$|$9$|$=3$|-|$\\le 10$|$A=\\begin{bmatrix}0 & 1 & 2\\\\1 & 1 & 2\\\\2 & 2 & 2\\end{bmatrix}$|\r\n|$5$|$9$|$=3$|-|$\\le 10$|$A=\\begin{bmatrix}0 & 1 & 0\\\\1 & 0 & 1\\\\0 & 1 & 2\\end{bmatrix}$|\r\n|$6$|$10$|$\\le 8$|-|-|$(S,\\circ)$ 是[循环群][1]|\r\n|$7$|$11$|-|-|-|$(S,\\circ)$ 是[群][2]|\r\n|$8$|$11$|-|-|-|$\\forall i,i\\circ i=i$|\r\n|$9$|$5$|$\\le 8$|-|-|-|\r\n|$10$|$7$|$\\le 15$|-|-|-|\r\n|$11$|$13$|-|-|-|-|\r\n\r\n注：特殊限制中的矩阵，从上到下第 $i+1$ 行从左到右第 $j+1$ 列表示 $A_{i,j}$。\r\n\r\n[1]:https://en.wikipedia.org/wiki/Cyclic_group\r\n[2]:https://en.wikipedia.org/wiki/Group_(mathematics)\r\n[3]:https://en.wikipedia.org/wiki/Semilattice"}]}