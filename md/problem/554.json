{"title":"「LibreOJ Round #8」MIN&MAX II","time_limit":2000,"memory_limit":512,"tags":["LibreOJ Round","线段树","离线","平面图","数据结构","图论"],"operation":{"submit":"https://loj.ac/problem/554#submit_code","submissions":"https://loj.ac/submissions?problem_id=554","statistics":"https://loj.ac/problem/554/statistics/fastest","testdata":"https://loj.ac/problem/554/testdata","discussion":"https://loj.ac/discussion/problem/554"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"对于一个 $n$ 阶排列 $p$，我们建立一张**无向简单图** $G(p)$，有 $n$ 个节点，标号从 $1$ 到 $n$，每个点向左右两侧最近的比它大的点以及比它小的点连边。  \r\n形式化地，在 $G(p)$ 中，$\\forall u<v$，边 $(u,v)$ 存在当且仅当以下四个条件至少一个成立：\r\n\r\n* $p_u<p_v$，且不存在 $u<i<v$ 满足 $p_u<p_i$；\r\n* $p_u>p_v$，且不存在 $u<i<v$ 满足 $p_u>p_i$；\r\n* $p_u<p_v$，且不存在 $u<i<v$ 满足 $p_i<p_v$；\r\n* $p_u>p_v$，且不存在 $u<i<v$ 满足 $p_i>p_v$。\r\n\r\n对于区间 $[l,r]$，规定其对应的排列 $p[l:r]$ 表示与 $p_l,p_{l+1},\\cdots,p_r$ 大小顺序相同的 $(r-l+1)$ 阶排列。  \r\n例如，对于排列 $q=\\{1,4,2,5,3\\}$，$q[2:4]$ 表示与 $\\{4,2,5\\}$ 大小顺序相同的 $3$ 阶排列，即 $\\{2,1,3\\}$。\r\n\r\n无向图 $G$ 的最小[染色](https://en.wikipedia.org/wiki/Graph_coloring)数即给图的每个点染一种颜色，满足每条边的两端颜色不同，最少需要的颜色种类数。记为 $c(G)$。\r\n\r\n现在给定一个 $n$ 阶排列 $p$，请你求出 $G(p)$ 的染色数，另外有 $q$ 次询问，每次询问一个区间 $[l,r]$，请你求出其所有子区间对应的排列的图的染色数最大值 $\\mathrm{maxc}$，以及达到最大值的子区间个数 $\\mathrm{cnt}$。  \r\n（形式化地，对于一对 $l,r$，求所有满足 $l\\le l'\\le r'\\le r$ 的 $l',r'$ 中，$c(G(p[l':r']))$ 的最大值 $\\mathrm{maxc}$，以及满足 $c(G(p[l':r']))=i$ 的 $l',r'$ 组数 $\\mathrm{cnt}$。）\r\n\r\n<div class=\"lang-divider\"></div>\r\n\r\nFor an $n$-order permutation $p$, we set up an **undirected simple graph** $G(p)$ with $n$ vertices numbered from $1$ to $n$.\r\nWe create an edge between each vertice $i$ and the nearest vertices in each side which correspond a greater (or less) $p$ value than $p_i$.  \r\nFormally,in this graph, $\\forall u<v$, the edge $(u, v)$ exists iff at least one of the following four conditions hold:\r\n\r\n* $p_u<p_v$, and no $u<i<v$ exists such that $p_u<p_i$;\r\n* $p_u>p_v$, and no $u<i<v$ exists such that $p_u>p_i$;\r\n* $p_u<p_v$, and no $u<i<v$ exists such that $p_i<p_v$;\r\n* $p_u>p_v$, and no $u<i<v$ exists such that $p_i>p_v$.\r\n\r\nFor a segment $[l,r]$, define its **corresponding permutation** $p[l:r]$ as an $(r-l+1)$-order permutation with the same relative orders of elements as $p_l,p_{l+1},\\cdots,p_r$; that is, for all $1 \\leq i < j \\leq r-l+1$, the boolean value $[p_{l-1+i} < p_{l-1+j}]$ is the same as the boolean value $[(p[l:r])_i < (p[l:r])_j]$.   \r\nFor instance, for the permutation $q=\\{1,4,2,5,3\\}$, $q[2:4]$ is a permutation of length $3$ with the same relative orders of elements as $\\{4,2,5\\}$, i.e. $\\{2,1,3\\}$.\r\n\r\nThe [chromatic number](https://en.wikipedia.org/wiki/Graph_coloring) of an undirected graph $G$ is the smallest number of colors needed to give each vertex a color such that every edge connects two vertices with different colors. We call this $c(G)$.\r\n\r\nGiven a permutation $p$ of length $n$, please find the chromatic number of $G(p)$.   \r\nAdditionally, please answer $q$ queries in the form of $[l,r]$ asking for: the greatest chromatic number among those of all **corresponding permutations** of each subsegment of $[l,r]$, $\\mathrm{maxc}$; and the number of subsegment that achieve this maximum number $\\mathrm{cnt}$.  \r\n(Formally,for each given $l,r$,$\\forall l\\le l'\\le r' \\le r$,calculate the maximum possible value of $c(G(p[l':r']))$,called $\\mathrm{maxc}$,and $\\sum_{l\\leqslant l'\\leqslant r'\\leqslant r}[c(G(p[l':r']))=\\mathrm{maxc}]=\\mathrm{cnt}$ .)"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行一个正整数 $n$。\r\n\r\n第二行 $n$ 个正整数 $p_1,p_2,\\cdots ,p_n$。\r\n\r\n第三行一个整数 $q$。\r\n\r\n接下来 $q$ 行每行两个正整数 $l,r$ 表示一组询问。\r\n\r\n<div class=\"lang-divider\"></div>\r\n\r\nThe first line contains a positive integer $n$.\r\n\r\nThe second line contains $n$ positive integers $p_1,p_2,\\cdots ,p_n$.\r\n\r\nThe third line contains an integer $q$.\r\n\r\nThe following $q$ lines each contains two positive integers $l,r$, denoting a query."},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出共 $q+1$ 行，第一行一个正整数表示 $G(p)$ 的染色数，接下来每行两个整数 $\\mathrm{maxc},\\mathrm{cnt}$。\r\n\r\n<div class=\"lang-divider\"></div>\r\n\r\nOutput contains $q+1$ lines in total. The first one should contain a positive integer denoting the chromatic number of $G(p)$, followed by $q$ lines each containing two integers $\\mathrm{maxc},\\mathrm{cnt}$ for each query."},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n6\r\n1 4 5 3 6 2\r\n5\r\n1 6\r\n1 3\r\n2 5\r\n2 6\r\n3 3\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n4\r\n4 1\r\n2 3\r\n3 3\r\n3 6\r\n1 1\r\n```\r\n\r\n#### 样例解释\r\n\r\n下图描述 $G(p)$ 及一种染色方案：\r\n\r\n![sampleexp.png](https://i.loli.net/2018/02/22/5a8e31e2d7179.png)\r\n\r\n<div class=\"lang-divider\"></div>\r\n\r\n#### Sample Input\r\n```plain\r\n6\r\n1 4 5 3 6 2\r\n5\r\n1 6\r\n1 3\r\n2 5\r\n2 6\r\n3 3\r\n```\r\n\r\n#### Sample Output\r\n```plain\r\n4\r\n4 1\r\n2 3\r\n3 3\r\n3 6\r\n1 1\r\n```\r\n\r\n#### Sample Explanation\r\n\r\nThe following picture describes $G(p)$ and a way of coloring:\r\n\r\n![sampleexp.png](https://i.loli.net/2018/02/22/5a8e31e2d7179.png)"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有数据，$1\\le n\\le 3\\times 10^5,0\\le q\\le 3\\times 10^5$。\r\n\r\n详细的数据限制及约定如下（留空表示和上述所有数据的约定相同）：\r\n\r\n|Subtask #|分值（百分比）|$n$|$q$|\r\n|:-:|:-:|:-:|:-:|\r\n|$1$|$10$|$\\le 10$|$\\le 10$|\r\n|$2$|$15$|$\\le 100$|$\\le 10^4$|\r\n|$3$|$15$|$\\le 2000$|$\\le 10^4$|\r\n|$4$|$15$|-|$=0$|\r\n|$5$|$15$|-|$\\le 5$|\r\n|$6$|$30$|-|-|\r\n\r\n<div class=\"lang-divider\"></div>\r\n\r\nFor all test cases, $1\\le n\\le 3\\times 10^5,0\\le q\\le 3\\times 10^5$.\r\n\r\nDetailed constraints and hints are as follows (blank grids denote the same constraints as mentioned above):\r\n\r\n|Subtask #|Score (percentage)|$n$|$q$|\r\n|:-:|:-:|:-:|:-:|\r\n|$1$|$10$|$\\le 10$|$\\le 10$|\r\n|$2$|$15$|$\\le 100$|$\\le 10^4$|\r\n|$3$|$15$|$\\le 2000$|$\\le 10^4$|\r\n|$4$|$15$|-|$=0$|\r\n|$5$|$15$|-|$\\le 5$|\r\n|$6$|$30$|-|-|"}]}