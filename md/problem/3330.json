{"title":"「WC2020」猜数游戏","time_limit":2000,"memory_limit":128,"tags":["WC","2020","离散对数","数论"],"operation":{"submit":"https://loj.ac/problem/3330#submit_code","submissions":"https://loj.ac/submissions?problem_id=3330","statistics":"https://loj.ac/problem/3330/statistics/fastest","testdata":"https://loj.ac/problem/3330/testdata","discussion":"https://loj.ac/discussion/problem/3330"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"黑板上写有 $n$ 个互不相等且都小于 $p$ 的正整数 $a_1, a_2, \\cdots, a_n$。小 J 想用这些数字和小 M 玩一个猜数游戏。\r\n\r\n游戏规则十分简单：游戏开始时，小 J 会从这些数字中随机选择若干个让小 M 来猜，而小 M 则可以通过若干次**询问**来确定小 J 选择了哪些数字。\r\n\r\n每一次**询问**的模式如下：小 M 可以任意指定一个数字 $a_k$，若它是小 J 所选择的数字之一，则小 J 会告诉小 M 他所选择的数字中所有能表示成 $(a_k)^m \\bmod p$ 的数，其中 $m$ 是任意正整数，$\\bmod$ 表示求二者做带余除法后的余数。反之，若 $a_k$ 没有被小 J 选中，则小 J 只会告诉小 M $a_k$ 没有被选中。\r\n\r\n游戏会在小 M 确定小 J 所选中的所有数字后立刻结束。\r\n\r\n例如，若 $n=4$，$p=7$，数字 $\\{a_n\\}$ 按下标顺序依次为 $\\{1, 3, 4, 6\\}$，小 J 选定的数字为 $\\{1, 4, 6\\}$，一种可能的游戏进行的过程（并非是最优过程）如下：\r\n\r\n| 小 M 的询问 | 小 J 的反馈                           |\r\n| :-----------: | :-------------------------------------: |\r\n| $a_2 = 3$   | $a_2$ 没有被选中                      |\r\n| $a_4 = 6$   | $6(= 6^1 \\bmod 7)$，$1(=6^2 \\bmod 7)$ |\r\n| $a_3 = 4$   | $4(= 4^1 \\bmod 7)$，$1(=4^3 \\bmod 7)$ |\r\n\r\n$3$ 次询问后小 J 所选出的所有数都已被小 M 确定，游戏结束。\r\n\r\n小 M 还有作业没有写完，因此他需要对游戏进行的时间进行评估。他想知道为了使游戏结束，他所需要做出询问的最小次数的期望 $S$ 是多少。\r\n\r\n为了避免精度误差，你需要输出答案乘 $(2^n - 1)$ 后模 $998244353$ 的余数。在本题中，你可以认为小 J 每次在选数时会在集合 $\\{a_1, a_2, \\cdots, a_n\\}$ 的全部**非空子集**中等概率地选择一个，在这个前提下可以证明 $(2^n - 1) \\times S$ 一定是一个整数。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个正整数 $n$ 和 $p$。\r\n\r\n第二行 $n$ 个正整数，依次表示 $a_1, a_2, \\cdots, a_n$。\r\n\r\n"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"仅一行一个整数表示答案。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n\r\n```plain\r\n4 7\r\n1 3 4 6\r\n```\r\n\r\n#### 样例输出 1\r\n\r\n```plain\r\n17\r\n```\r\n\r\n#### 样例解释 1\r\n\r\n下表给出了小 J 所选的子集与小 M 最小询问次数的关系：\r\n\r\n| 小 J 所选的子集                                              | 最优的询问集合 |\r\n| :------------------------------------------------------------: | :--------------: |\r\n| $\\{1\\}$                                                      | $\\{1 \\}$        |\r\n| $\\{3\\}, \\{3, 4\\}, \\{3, 6\\}, \\{3, 4, 6\\}, \\{1, 3\\}, \\{1, 3, 4\\}, \\{1, 3, 6\\}, \\{1, 3, 4, 6\\}$ | $\\{3\\}$        |\r\n| $\\{4\\}, \\{1, 4\\}$                                            | $\\{4\\}$        |\r\n| $\\{6\\}, \\{1, 6\\}$                                            | $\\{6\\}$        |\r\n| $\\{4, 6\\}, \\{1, 4, 6\\}$                                      | $\\{4,6\\}$      |\r\n\r\n因此最小询问次数的期望 $S = \\frac{17}{15}$。\r\n\r\n#### 样例输入 2\r\n\r\n```plain\r\n8 9\r\n1 2 3 4 5 6 7 8\r\n```\r\n\r\n#### 样例输出 2\r\n\r\n```plain\r\n532\r\n```\r\n\r\n#### 样例 3\r\n\r\n见附加文件中的 `game3.in` 与 `game3.ans`。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有测试点：$1 \\leq n \\leq 5000$，$3 \\leq p \\leq 10^8$，$1 \\leq a_i < p\\ (1 \\leq i \\leq n)$ 且 $a_i$ 两两不同。\r\n\r\n对于所有编号为奇数的测试点，保证 $p$ 是一个素数；对于所有编号为偶数的测试点，保证存在奇素数 $q$ 和正整数 $k > 1$ 使得 $p = q^k$。\r\n\r\n| 测试点编号 | $n\\leq$ | $p\\le$ | 特殊性质 | 测试点编号 | $n\\leq$ | $q\\le$ | 特殊性质 |\r\n| :----------: | :-------: | :------: | :--------: | :----------: | :-------: | :------: | :--------: |\r\n| $1$        | $10$    | $100$  | 无       | $2$        | $10$    | $100$  | 无       |\r\n| $3$   |$10$|$100$|无| $4$|$10$|$100$|无|\r\n| $5$        | $200$   | $5000$| 无 | $6$      | $200$      | $5000$  |     无   | \r\n| $7$        | $300$   | $10^6$ |无| $8$      | $300$      | $10^6$  | 无|\r\n| $9$|$300$ |$10^6$  | A| $10$   | $300$   | $10^6$ |B|\r\n| $11$       | $5000$  | $10^7$ |A| $12$     | $5000$     | $10^7$  | 无     | \r\n| $13$|$5000$|$10^7$  | 无     | $14$   | $5000$|$10^7$| 无|\r\n| $15$|$5000$  | $10^8$  | A      | $16$     | $5000$|$10^8$     | B|\r\n| $17$       | $5000$|$10^8$|无      | $18$ |$5000$|$10^8$| 无       | \r\n| $19$       | $5000$|$10^8$|无      | $20$ |$5000$|$10^8$| 无       | \r\n\r\n特殊性质 A：在模 $p$ 意义下 $3^i\\ (1 \\leq i \\leq p - 1)$ 两两不同余。\r\n\r\n特殊性质 B：对所有的 $1 \\leq i \\leq n$ 都有 $(a_i, p) > 1$。\r\n\r\n"}]}