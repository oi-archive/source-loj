{"title":"「ROIR 2018 Day1」管道监控","time_limit":1000,"memory_limit":512,"tags":["2018","ROIR"],"operation":{"submit":"https://loj.ac/problem/3026#submit_code","submissions":"https://loj.ac/submissions?problem_id=3026","statistics":"https://loj.ac/problem/3026/statistics/fastest","testdata":"https://loj.ac/problem/3026/testdata","discussion":"https://loj.ac/discussion/problem/3026"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**译自 ROI 2018 Regional. Day1 T4.** ***[Мониторинг труб](http://neerc.ifmo.ru/school/archive/2017-2018/ru-olymp-regional-2018-day1.pdf)***\r\n\r\n某输气系统包含 $n$ 个节点，编号分别为 $1\\ldots n$，某些节点间有单向管道连接。1 号节点是中央储气设施。\r\n\r\n节点系统可用数列 $p_2,$ $p_3,$ $\\ldots,$ $p_n$ 来表示。对于 $i\\in[\\;\\!2,n\\;\\!],$ $p_i$ 号节点会有一条通向 $i$ 号节点的单向管道。已知中央储气设施可以将气体输送到系统中的所有节点。输气系统包含不同种类的管道，用英文小写字母 a~z 来表示。$p_i$ 号节点通向 $i$ 号节点的管道的类型为 $c_i$。\r\n\r\n有一种特殊的机器人被用来检查管道的质量。我们把「机器人从一个节点沿着一根管道前行到另一个节点，且机器人前进方向与气体方向一致」称作「一次移动」。\r\n\r\n机器人会先被放在一个节点中，然后它会进行一次或多次移动，最后被人从输气系统中取出。这被称为「机器人进行了一次执勤」。\r\n\r\n每次执勤时都需遵循 $m$ 种「规格」中的其中一种，这些规格的编号分别为 $1\\ldots m$。每种规格都用一个由英文小写字母组成的字符串 $st_k$ 来表示。如果在一次执勤中机器人遵循了 $k$ 号规范，则在这次执勤中，机器人移动的次数与 $\\mathrm{len}(st_k)$ 相等，并且对于 $i\\in[1,\\mathrm{len}(st_k)],$ $st_{k\\:\\!,\\;\\!j}$ 等于机器人第 $j$ 次经过的管道的编号。\r\n\r\n若某次执勤遵循了 $t$ 号规格，则这次的花费为 $w_t$。\r\n\r\n请问，要想让所有的管道都至少被检查一次，至少需要花费多少钱，并给出执勤路线的方案。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"$n,m,t$（$t$ 的含义会在下面告诉你）  \r\n接下来 $n-1$ 行：$p_i,$ $c_i$  \r\n接下来 $m$ 行：$w_i,$ $st_i$"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"第一行包含一个整数，表示最小花费。若无解请输出 -1.  \r\n若 $t=0$ 就不用管后续了，若 $t=1$ 且有解则需输出方案。  \r\n输出方案时，在第一行输出最小花费之后，第二行应包含方案中路径的数量 $k$，接下来 $k$ 行，每行包括三个整数 $a_i,$ $b_i,$ $c_i$，依次表示一条执勤路线的起点、终点，以及这次执勤所使用的规格。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n3 3 0\r\n1 a\r\n2 b\r\n3 a\r\n4 b\r\n2 a\r\n```\r\n#### 样例输出 1\r\n```plain\r\n6\r\n```\r\n#### 样例输入 2\r\n```plain\r\n7 3 1\r\n1 a\r\n2 a\r\n3 b\r\n3 b\r\n1 b\r\n6 b\r\n3 aab\r\n5 b\r\n2 ab\r\n```\r\n#### 样例输出 2\r\n```plain\r\n15\r\n4\r\n1 4 1\r\n2 5 3\r\n1 6 2\r\n6 7 2\r\n```\r\n#### 样例说明 2\r\n![kxhEVg.png](https://s2.ax1x.com/2019/03/07/kxhEVg.png)"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有数据，$1 ≤ n ≤ 500,$ $1 ≤ m ≤ 10^5,$ $t=0$ 或 $1,$ $1 ≤ p_i ≤ i-1,$ $1 ≤ w_i ≤ 10^9,$ $\\sum \\mathrm{len}(st_k) ≤ 10^6$.\r\n\r\n|子任务 #|分值|$n≤$|$m≤$|特殊条件|$t$|依赖的 <br> 子任务|\r\n|:-:|:-:|:-:|:-:|:-:|:-:|:-:|\r\n|1|9|$500$| $10^5$|$\\mathrm{len}(st_i)=1$|$t = 0$||\r\n|2|10|$500$| $10^5$|$p_i=i-1$|$t = 0$|&nbsp;|\r\n|3|22|$15$| $10^5$||$t = 0$||\r\n|4|20|$500$| $500$|&nbsp;|$t = 0$|&nbsp;|\r\n|5|19|$500$| $10^5$||$t = 0$|1 – 4|\r\n|6|20|$500$| $10^5$|&nbsp;|$t = 1$|1 – 5|"}]}