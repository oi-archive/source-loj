{"title":"然而第六章的 A 面并没有草莓","time_limit":1000,"memory_limit":512,"tags":["树形 DP","树上差分","LCA","DP"],"operation":{"submit":"https://loj.ac/problem/6699#submit_code","submissions":"https://loj.ac/submissions?problem_id=6699","statistics":"https://loj.ac/problem/6699/statistics/fastest","testdata":"https://loj.ac/problem/6699/testdata","discussion":"https://loj.ac/discussion/problem/6699"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**Source: [Educational Codeforces Round 46 (Rated for Div. 2) G. Two-Paths](https://codeforces.com/problemset/problem/1000/G)**\r\n\r\n从危险的神庙中逃离后，Madeline 与 Theo 在悬崖边点燃了篝火准备休息。但当 Madeline 从噩梦中惊醒时，她发现自己的半个身子已经滑落了悬崖的边缘。当 Theo 慌忙起身时，Madeline 已从悬崖边坠落……\r\n\r\n在 Celeste 山上，会发生许多不可思议的事情。当 Madeline（以下简称小 M）再一次醒来时，她发现自己身处地下深处，而 Badeline ——她的负面情绪的化身（以下简称小 B）则幽异地飘在空中，对她露出不祥的笑容。\r\n\r\n小 M 发现她所处的区域可以抽象成一个含有 $n$ 个关键点的图，且有 $n-1$ 对关键点之间直接相连，满足任意两个关键点之间有且仅有一条不重复经过关键点的路径。\r\n\r\n初始时小 M 在关键点 $u_1$，而小 B 在关键点 $v_1$。为了能够战胜小 B，小 M 需要从她当前所在的关键点前往小 B 所在的关键点。然后小 B 会将小 M 反弹到关键点 $u_2$，而她自己瞬移到关键点 $v_2$，小 M 需要再从 $u_2$ 前往 $v_2$。这样的过程会重复 $q$ 次。形式化地说，小 M 需要做出 $q$ 次行动，每次行动给出一对 $\\left<u_i,v_i\\right>$，小 M 需要从关键点 $u_i$ 前往关键点 $v_i$。\r\n\r\n每个关键点内都包含一定数量的草莓，更具体地，第 $i$ 个关键点内包含 $a_i$ 个草莓。小 M 想要在一次行动中收集尽量多的草莓，小 M 每经过一个关键点 $x$，她就能收集这个关键点内包含的所有 $a_x$ 个草莓，**但是在同一次行动中，每个关键点内的草莓不能重复被收集**。\r\n\r\n每次小 M 能够前往**与当前所在的关键点直接相连**的关键点，但是她的移动十分危险，对于直接相连的一对关键点 $x\\leftrightarrow y$，从 $x$ 到 $y$ 和从 $y$ 到 $x$ 有着各自的危险程度。一次行动的**总危险程度**定义为每次移动的危险程度的和，**注意重复或反向的移动均算多次**。\r\n\r\n小 M 认为一次行动的收益为收集到的草莓的数量减去总危险程度，她想要你帮忙计算每次行动的最大收益。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个正整数 $n,q$，意义见题目描述。\r\n\r\n第二行一共 $n$ 个正整数，表示 $a_1,a_2,\\ldots,a_n$。\r\n\r\n接下来 $n-1$ 行，每行四个正整数 $x,y,z_1,z_2$ 表示关键点 $x$ 和 $y$ 直接相连，且从 $x$ 到 $y$ 的危险程度为 $z_1$，从 $y$ 到 $x$ 的危险程度为 $z_2$。\r\n\r\n接下来 $q$ 行，第 $i$ 行两个正整数 $u_i,v_i$，表示第 $i$ 次行动的起点和终点。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出 $q$ 行，第 $i$ 行包含一个整数，表示第 $i$ 次行动的最大收益。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n\r\n```palin\r\n7 9\r\n6 5 5 3 2 1 2\r\n1 2 3 1\r\n2 3 2 2\r\n2 4 1 1\r\n4 5 1 1\r\n6 4 1 3\r\n7 3 12 14\r\n1 1\r\n4 4\r\n5 6\r\n6 4\r\n3 4\r\n3 7\r\n5 1\r\n4 7\r\n7 1\r\n```\r\n\r\n#### 样例输出 1\r\n\r\n```plain\r\n9\r\n9\r\n8\r\n9\r\n12\r\n-3\r\n14\r\n0\r\n4\r\n```\r\n\r\n#### 样例解释 1\r\n\r\n每次行动的**最优行动方式之一**如下：\r\n\r\n$(1,1)$：$1\\to2\\to4\\to5\\to4\\to2\\to3\\to2\\to1$。\r\n\r\n其收益的计算方式为：\r\n\r\n收集到的草莓的数量为 $a_1+a_2+a_3+a_4+a_5=21$。\r\n\r\n总危险程度为 $3+1+1+1+1+2+2+1=12$。\r\n\r\n收益为 $21-12=9$。\r\n\r\n$(4,4)$：$4\\to2\\to1\\to2\\to3\\to2\\to4$。\r\n\r\n$(5,6)$：$5\\to4\\to2\\to3\\to2\\to1\\to2\\to4\\to6$。\r\n\r\n$(6,4)$：$6\\to4\\to2\\to1\\to2\\to3\\to2\\to4$。\r\n\r\n$(3,4)$：$3\\to2\\to1\\to2\\to4$。\r\n\r\n$(3,7)$：$3\\to2\\to1\\to2\\to4\\to5\\to4\\to2\\to3\\to7$。\r\n\r\n$(5,1)$：$5\\to4\\to2\\to3\\to2\\to1$。\r\n\r\n$(4,7)$：$4\\to5\\to4\\to2\\to1\\to2\\to3\\to7$。\r\n\r\n$(7,1)$：$7\\to3\\to2\\to4\\to2\\to1$。\r\n\r\n#### 样例 2\r\n\r\n见选手目录下的 `strawberry2.in` 与 `strawberry2.ans`。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有测试点：\r\n\r\n$1\\le n\\le2\\times10^5$，$1\\le q\\le5\\times10^5$\r\n\r\n$1\\le x,y,u_i,v_i\\le n$，$x\\ne y$，$1\\le a_i,z_1,z_2\\le10^4$\r\n\r\n保证任意两个关键点之间有且仅有一条不重复经过关键点的路径。\r\n\r\n每个测试点的具体限制见下表：\r\n\r\n| 测试点编号 | $n\\le$ | $q\\le$ | 特殊性质 |\r\n| :--: | :--: | :--: | :--: |\r\n| $1\\sim2$ | $10$ | $10$ | 无 |\r\n| $3\\sim4$ | $1000$ | $1000$ | A |\r\n| $5\\sim6$ | $1000$ | $1000$ | B |\r\n| $7\\sim8$ | $1000$ | $1000$ | 无 |\r\n| $9\\sim10$ | $2\\times10^5$ | $1$ | A |\r\n| $11\\sim12$ | $1000$ | $5\\times10^5$ | 无 |\r\n| $13\\sim14$ | $2\\times10^5$ | $5\\times10^5$ | A |\r\n| $15\\sim16$ | $2\\times10^5$ | $5\\times10^5$ | B |\r\n| $17\\sim20$ | $2\\times10^5$ | $5\\times10^5$ | 无 |\r\n\r\n特殊性质 A：$y = x + 1$。\r\n\r\n特殊性质 B：$x = 1$。\r\n\r\n---\r\n\r\n**Author: PinkRabbit**"}]}