{"title":"「SNOI2020」水池","time_limit":3000,"memory_limit":512,"tags":["SNOI","2020","线段树","单调栈","二分"],"operation":{"submit":"https://loj.ac/problem/3328#submit_code","submissions":"https://loj.ac/submissions?problem_id=3328","statistics":"https://loj.ac/problem/3328/statistics/fastest","testdata":"https://loj.ac/problem/3328/testdata","discussion":"https://loj.ac/discussion/problem/3328"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"有一个长条形的水池，可以划分成 $n$ 格。其中第 $i$ 格和 $i+1$ 格之间相邻，由一块高度为 $h_i$ 的可调节挡板隔开。第 $1$ 格左侧和第 $n$ 格右侧是无限高的池壁。初始时水池中没有水。现在进行 $q$ 次操作，操作有以下四种：\r\n\r\n- `0 i x h` 在第 $x$ 格灌水直到该格的水面高度不低于 $h$（若当前水面高度已经达到 $h$ 则无事发生）；\r\n- `1 i x` 打开第 $x$ 格底部的排水口直到该格的水流干，再关闭排水口；\r\n- `2 i x h` 将第 $x$ 格右侧的挡板高度增加到 $h$（不改变现有水面，保证挡板高度不会下降）；\r\n- `3 i x` 查询第 $x$ 格的水面高度。\r\n\r\n其中，$i$ 表示这次操作是基于第 $i$ 次操作之后的情况，$i=0$ 表示基于初始状态。也就是说，这个问题要求对操作可持久化。\r\n\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个自然数 $n,q$，表示水池格数和操作次数。\r\n\r\n接下来一行 $n-1$ 个正整数 $h_1, h_2, \\dots, h_{n-1}$ 表示挡板的初始高度。\r\n\r\n接下来 $q$ 行每行一个正整数表示一次操作。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对每个操作 $3$ 输出一行一个整数表示答案。\r\n"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n\r\n```plain\r\n4 9\r\n1 3 2\r\n0 0 4 2\r\n3 1 1\r\n0 2 4 3\r\n3 3 1\r\n0 4 4 4\r\n3 5 1\r\n2 6 1 4\r\n1 7 4\r\n3 8 1\r\n```\r\n\r\n#### 样例输出\r\n\r\n```plain\r\n0\r\n0\r\n4\r\n4\r\n```\r\n\r\n#### 样例解释\r\n\r\n![water.png](https://loj-img.upyun.menci.memset0.cn/2020/06/29/5ef98fcf44fd0.png)"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有数据，$1\\le n,q\\le 2\\times 10^5, 0\\le h_i\\le 10^9$。\r\n\r\n- 对于 $10\\%$ 的数据，$n\\le 500$；\r\n- 对于另外 $20\\%$，没有操作 $1$，且 $i$ 从 $0$ 开始连续增长（不需要可持久化）；\r\n- 对于另外 $20\\%$，没有操作 $1$；\r\n- 对于另外 $20\\%$，且 $i$ 从 $0$ 开始连续增长（不需要可持久化）；\r\n- 对于余下 $30\\%$ 的数据，无特殊限制。"}]}