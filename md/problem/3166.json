{"title":"「CEOI2019」魔法树","time_limit":2000,"memory_limit":1024,"tags":["CEOI","2019","线段树","树上启发式合并","DP"],"operation":{"submit":"https://loj.ac/problem/3166#submit_code","submissions":"https://loj.ac/submissions?problem_id=3166","statistics":"https://loj.ac/problem/3166/statistics/fastest","testdata":"https://loj.ac/problem/3166/testdata","discussion":"https://loj.ac/discussion/problem/3166"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**译自 [CEOI 2019](https://ceoi.sk/tasks/) Day2 T2「[Magic Tree](https://ceoi.sk/static/statements/magictree-ENG.pdf)」**\r\n\r\n现在有一颗魔法树，总共有 $n$ 个节点，编号从 $1$ 至 $n$。$1$ 节点是它的根。除 $1$ 节点外的每个节点最多长有一个魔法果实。一个长在 $v_j$ 节点的魔法果实恰会在第 $d_j$ 天成熟，在成熟时将其收获可以获得 $w_j$ 单位的果汁。\r\n\r\n每天你可以砍下树上的某些边，然后当天与 $1$ 节点不再联通的果实如果恰好在当天成熟，则能够收获该果实的果汁。\r\n\r\n请找出最优方案下，总共能够收获的果汁量。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行三个正整数 $n, m, k$，分别表示节点数，果实数，所有果实成熟时间的上限。\r\n\r\n接下来共 $n-1$ 行，每行一个正整数分别为 $p_2, p_3, \\dots, p_n$，$p_i$ 表示 $i$ 节点的父亲。\r\n\r\n接下来共 $m$ 行，每行三个正整数 $v_j, d_j, w_j$，分别表示该果实生长的节点编号，成熟日期，能收获的果汁。保证 $v_j$ 互不相同。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出一行一个整数，表示最优方案下，总共能够收获的果汁量。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n\r\n```plain\r\n6 4 10\r\n1\r\n2\r\n1\r\n4\r\n4\r\n3 4 5\r\n4 7 2\r\n5 4 1\r\n6 9 3\r\n```\r\n\r\n#### 样例输出\r\n\r\n```plain\r\n9\r\n```\r\n\r\n#### 样例解释\r\n\r\n- 在第 $4$ 天，砍下 $5$ 号节点连接父亲的边，从 $5$ 号节点上的果实收获 $1$ 单位的果汁。砍下 $2$ 节点连接父亲的边，从 $3$ 号节点上的果实收获 $5$ 单位的果汁。\r\n- 在第 $9$ 天，砍下 $4$ 号节点连接父亲的边，从 $6$ 号节点上的果实收获 $3$ 单位的果汁。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于 $100\\%$ 的数据，保证 $2\\le n \\le 10^5, 1\\le m \\le n - 1, 1\\le k \\le 10^5, 1\\le p_i \\le i - 1, 2\\le v_j \\le n, 1\\le d_j\\le k, 1\\le w_j \\le 10^9$。\r\n\r\n|Subtask #|分值|特殊限制|\r\n|:-:|:-:|:-:|\r\n|$1$|$6$|$n, k\\le 20, w_j = 1$|\r\n|$2$|$3$|果实都生长在叶子上|\r\n|$3$|$11$|$p_i = i-1, w_j = 1$|\r\n|$4$|$12$|$k\\le 2$|\r\n|$5$|$16$|$k\\le 20, w_j = 1$|\r\n|$6$|$13$|$m\\le 10^3$|\r\n|$7$|$22$|$w_j = 1$|\r\n|$8$|$17$||"}]}