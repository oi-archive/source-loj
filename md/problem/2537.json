{"title":"「PKUWC2018」Minimax","time_limit":1000,"memory_limit":512,"tags":["2018","线段树","树形 DP","数据结构","DP"],"operation":{"submit":"https://loj.ac/problem/2537#submit_code","submissions":"https://loj.ac/submissions?problem_id=2537","statistics":"https://loj.ac/problem/2537/statistics/fastest","testdata":"https://loj.ac/problem/2537/testdata","discussion":"https://loj.ac/discussion/problem/2537"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"小 $C$ 有一棵 $n$ 个结点的有根树，根是 $1$ 号结点，且每个结点最多有两个子结点。\r\n\r\n定义结点 $x$ 的权值为：\r\n\r\n1.若 $x$ 没有子结点，那么它的权值会在输入里给出，**保证这类点中每个结点的权值互不相同**。\r\n\r\n2.若 $x$ 有子结点，那么它的权值有 $p_x$ 的概率是它的子结点的权值的最大值，有 $1-p_x$ 的概率是它的子结点的权值的最小值。\r\n\r\n现在小 $C$ 想知道，假设 $1$ 号结点的权值有 $m$ 种可能性，**权值第 $i$ 小**的可能性的权值是 $V_i$，它的概率为 $D_i(D_i>0)$，求：\r\n\r\n$$\\sum_{i=1}^{m}i\\cdot V_i\\cdot D_i^2$$\r\n\r\n你需要输出答案对 $998244353$ 取模的值。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行一个正整数 $n$；  \r\n第二行 $n$ 个整数，第 $i$ 个整数表示第 $i$ 个结点的父亲的编号，其中第 $1$ 个结点的父亲为 $0$；  \r\n第三行 $n$ 个整数，若第 $i$ 个结点没有子结点，则第 $i$ 个数为它的权值，否则第 $i$ 个数为 $p_i\\cdot 10000$，保证 $p_i\\cdot 10000$ 是个正整数。\r\n"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出答案。\r\n"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 输入样例\r\n\r\n```plain\r\n3\r\n0 1 1\r\n5000 1 2\r\n```\r\n\r\n#### 输出样例\r\n```plain\r\n748683266\r\n```\r\n\r\n#### 样例解释\r\n1号结点的权值有 $\\frac{1}{2}$ 的概率是 $1$，有 $\\frac{1}{2}$ 的概率是 $2$，所以答案是 $\\frac{5}{4}$。\r\n\r\n"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于 $10\\%$ 的数据，有$1\\leq n\\leq 20$；  \r\n对于 $20\\%$ 的数据，有$1\\leq n\\leq 400$；  \r\n对于 $40\\%$ 的数据，有$1\\leq n\\leq 5000$；  \r\n对于 $60\\%$ 的数据，有$1\\leq n\\leq 10^5$；  \r\n另有 $10\\%$ 的数据保证树的形态随机。  \r\n对于 $100\\%$ 的数据，有 $1\\leq n\\leq 3\\times 10^5$，$1\\leq w_i\\leq 10^9$。\r\n\r\n对于所有数据，满足 $0 < p_i \\cdot 10000 < 10000$，所以易证明所有叶子的权值都有概率被根取到。\r\n"}]}