{"title":"「雅礼集训 2018 Day10」贪玩蓝月","time_limit":4000,"memory_limit":512,"tags":["雅礼集训","2018","线段树","背包 DP","数据结构"],"operation":{"submit":"https://loj.ac/problem/6515#submit_code","submissions":"https://loj.ac/submissions?problem_id=6515","statistics":"https://loj.ac/problem/6515/statistics/fastest","testdata":"https://loj.ac/problem/6515/testdata","discussion":"https://loj.ac/discussion/problem/6515"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"> 大渣好，我四渣渣辉，点一下，玩一年，装备不花一分钱，说话战斗，罩杯回收，找一基友，极限到手。\r\n>\r\n> 0 元 VIP，3 天满级，一秒一刀 999，装备全爆 666，广告做得再牛，不如进服遛一遛！\r\n>\r\n> 古天乐绿了，古天乐绿了，惊喜不断，月入上万！不花钱还赚钱的绿色游戏，等级能提现，装备换点钱！\r\n\r\n《贪玩蓝月》是目前最火爆的网页游戏。在游戏中每个角色都有若干装备，每件装备有一个特征值 $w$ 和一个战斗力 $v$ 。在每种特定的情况下，你都要选出特征值的和对 $p$ 取模后在一段范围内的装备，而角色死亡时自己的装备会爆掉。每个角色的物品槽可以看成一个双端队列，得到的装备会被放在两端，自己的装备爆掉也会在两端被爆。\r\n\r\n现在我们有若干种事件和询问，如下所示：\r\n\r\n- `IF w v`：在前端加入一件特征值为 $w$ 战斗力为 $v$ 的装备\r\n- `IG w v`：在后端加入一件特征值为 $w$ 战斗力为 $v$ 的装备\r\n- `DF`：删除最前端的装备\r\n- `DG`：删除最后端的装备\r\n- `QU l r`：在当前的装备中选取若干装备，他们的和对 $p$ 取模后在 $[l, r]$ 中，使得这些装备的战斗力之和最大\r\n\r\n为了锻炼你的水平，请尽量使用在线做法。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行一个整数表示测试点编号。\r\n\r\n第二行两个整数 $m$ 和 $p$，分别表示操作数和模数。\r\n\r\n接下来每一行一个操作，如题目描述中所述，有五种操作，在前后加或删一件物品或者询问。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于每个询问，输出一行，表示在当前装备中选取若干装备和对 $p$ 取模后在 $[l, r]$ 的装备，使得这些装备战斗力之和最大。如果没有合法方案，输出 $-1$。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n0\r\n11 10\r\nQU 0 0\r\nQU 1 9\r\nIG 14 7\r\nIF 3 5\r\nQU 0 9\r\nIG 1 8\r\nDF\r\nQU 0 4\r\nIF 1 2\r\nDG\r\nQU 2 9\r\n```\r\n\r\n#### 样例输出 1\r\n```plain\r\n0\r\n-1\r\n12\r\n8\r\n9\r\n```\r\n\r\n#### 样例解释 1\r\n\r\n一开始没有物品，那么可以不选，特征值价值为 $0$，不可能凑出非 $0$ 的特征值。\r\n\r\n然后在后面加了一个特征值 $14$ 价值 $7$ 的装备，又在前面加了一个特征值 $3$ 价值 $5$ 的装备，询问特征值取模后为 $[0, 9]$ 的装备，那么全部选择价值为 $12$。\r\n\r\n然后在后面加了一个特征值为 $1$ 价值为 $8$ 的装备，删除了最前面的装备（特征值 $3$ 价值 $5$），询问特征值取模后为 $[0, 4]$ 的装备，那么只选择特征值为 $1$ 价值为 $8$ 的装备，最大价值为 $8$。\r\n\r\n最后又在前面加了一个特征值为 $1$ 价值为 $2$ 的装备，删除了最后面的装备（特征值 $1$ 价值 $8$），询问特征值取模后为 $[2, 9]$ 的装备，那么选择当前剩余的两件装备，价值和为 $9$。\r\n"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"| 测试点编号 | $m$ | $p$ | 特殊情况 |\r\n| :-: | :-: | :-: | :-: |\r\n| 1 | $\\leq 10$ | | | \r\n| 2 | $\\leq 20$ | | |\r\n| 3 | $\\leq 100$ | | |\r\n| 4 | $\\leq 200$ | | |\r\n| 5 | $\\leq 3000$ | $\\leq 10$ | |\r\n| 6 | $\\leq 3000$ | | 保证询问中有 $l = r$ |\r\n| 7 | $\\leq 3000$ | | |\r\n| 8 | | $ = 2$ | |\r\n| 9 | | $\\leq 3$ | |\r\n| 10 | | $\\leq 5$ | |\r\n| 11 | | $\\leq 10$ | |\r\n| 12 | | | 只有 `IF`，`IG` 操作和询问 |\r\n| 13 | | | 只有 `IG`，`DG` 操作和询问 |\r\n| 14 | | | 只有 `IG`，`DG` 操作和询问 |\r\n| 15 | | | 只有 `IG`，`DG` 操作和询问，且保证询问中有 $l  = r$ |\r\n| 16 | | | 保证询问中有 $l  = r$ |\r\n| 17 | | | 只有 `IG`，`DF` 操作和询问 |\r\n| 18 | | | 只有 `IG`，`DF` 操作和询问 |\r\n| 19 | $\\leq 25000$ | | |\r\n| 20 | | | | |\r\n\r\n对于所有数据， $m \\leq 50000, p \\leq 500, 0 \\leq w, v < 10^9$，保证没有物品时不会进行删除操作。"}]}