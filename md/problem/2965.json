{"title":"「COCI 2010.02」PALACINKE","time_limit":1000,"memory_limit":32,"tags":["2010","COCI"],"operation":{"submit":"https://loj.ac/problem/2965#submit_code","submissions":"https://loj.ac/submissions?problem_id=2965","statistics":"https://loj.ac/problem/2965/statistics/fastest","testdata":"https://loj.ac/problem/2965/testdata","discussion":"https://loj.ac/discussion/problem/2965"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":" **译自 [COCI 2010.02](http://hsin.hr/coci/archive/2009_2010/) T6.** ***[PALACINKE](http://hsin.hr/coci/archive/2009_2010/contest4_tasks.pdf)***\r\n\r\n安娜有几个同学过来吃可丽饼，然而安娜忘了这事。当安娜发现时，留给她烤可丽饼的时间只剩下 $T$ 分钟了。她马上跑出去采购四样原材料：面粉 `B`，鸡蛋 `J`，牛奶 `M` 和果酱 `P`。\r\n\r\n安娜周边有 $N$ 个路口，编号为 $1\\ldots N$，还有 $M$ 条单向道路连接它们。已知每条路上的商店会卖哪些材料，保证每条路上的商店至少会卖（上述四种材料中）的一种。\r\n\r\n<center><img src=\"https://i.loli.net/2018/12/30/5c28d77cb9ba1.png\" width=\"200px\"/></center>\r\n\r\n安娜穿过一条道路时，如果她进入了这条路上的商店（不一定买东西，她可能只是去比比价格），则她通过这条路耗时 $2$ 分钟，否则耗时 $1$ 分钟。\r\n\r\n安娜需要在 $T$ 分钟内采购到四种原材料。请问她有多少种「采购方式」，答案对 $5557$ 取模。采购方式包含了她经过的结点的次序，以及她在每条路上买不买材料，但不计她在哪个商店买了什么。例如，当 $T=7$ 时，在上图中有 $5$ 种采购方式：\r\n\r\n<table>\r\n<thead>\r\n<tr>\r\n<th>1 min</th>\r\n<th>2 min</th>\r\n<th>3 min</th>\r\n<th>4 min</th>\r\n<th>5 min</th>\r\n<th>6 min</th>\r\n<th>7 min</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr>\r\n<td>1→3</td>\r\n<td colspan=\"2\">3→商店→4</td>\r\n<td colspan=\"2\">4→商店→1</td>\r\n<td></td>\r\n<td></td>\r\n</tr>\r\n<tr>\r\n<td colspan=\"2\">1→商店→2</td>\r\n<td colspan=\"2\">2→商店→4</td>\r\n<td colspan=\"2\">4→商店→1</td>\r\n<td></td>\r\n</tr>\r\n<tr>\r\n<td colspan=\"2\">1→商店→3</td>\r\n<td colspan=\"2\">3→商店→4</td>\r\n<td colspan=\"2\">4→商店→1</td>\r\n<td></td>\r\n</tr>\r\n<tr>\r\n<td colspan=\"2\">1→商店→3</td>\r\n<td colspan=\"2\">3→商店→4</td>\r\n<td>4→5</td>\r\n<td colspan=\"2\">5→商店→1</td>\r\n</tr>\r\n<tr>\r\n<td>1→3</td>\r\n<td colspan=\"2\">3→商店→4</td>\r\n<td colspan=\"2\">4→商店→5</td>\r\n<td colspan=\"2\">5→商店→1</td>\r\n</tr>\r\n</tbody>\r\n</table>"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行：$N,M$。  \r\n接下来 $N$ 行，每行两个整数 $u,v$ 和一个仅可能包含 `BJMP` 四种字符的字符串 $s$，$u,v$ 表示一条单向道路，$s$ 表示这条道路上的商店会卖哪些材料。保证没有两条单向道路相同（但可能有两条连接的结点相同，而方向相反的道路）。  \r\n第 $N+2$ 行：$T$。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"一行，一个答案，表示安娜有多少种采购方式。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n3 3\r\n1 2 BMJ\r\n2 3 MJP\r\n3 1 JPB\r\n5\r\n```\r\n\r\n#### 样例输出 1\r\n```plain\r\n3\r\n```\r\n\r\n#### 样例输入 2\r\n```plain\r\n3 4\r\n1 2 B\r\n2 1 P\r\n1 3 J\r\n3 1 M\r\n8\r\n```\r\n\r\n#### 样例输出 2\r\n```plain\r\n2\r\n```\r\n\r\n#### 样例输入 3\r\n```plain\r\n5 7\r\n1 2 B\r\n2 4 M\r\n1 3 J\r\n3 4 MB\r\n4 1 JP\r\n4 5 J\r\n5 1 P\r\n7\r\n```\r\n\r\n#### 样例输出 3\r\n```plain\r\n5\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"$1\\le N\\le 25,$ $1\\le M\\le 500,$ $1\\le T\\le 10^9$.  \r\n保证没有两条单向道路相同（但可能有两条连接的结点相同，而方向相反的道路）。"}]}