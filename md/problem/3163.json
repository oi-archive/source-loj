{"title":"「CEOI2019」动态直径","time_limit":6000,"memory_limit":1024,"tags":["CEOI","2019","树链剖分","点分治","DP"],"operation":{"submit":"https://loj.ac/problem/3163#submit_code","submissions":"https://loj.ac/submissions?problem_id=3163","statistics":"https://loj.ac/problem/3163/statistics/fastest","testdata":"https://loj.ac/problem/3163/testdata","discussion":"https://loj.ac/discussion/problem/3163"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**译自 [CEOI 2019](https://ceoi.sk/tasks/) Day1 T2「[Dynamic Diameter](https://ceoi.sk/static/statements/diameter-ENG.pdf)」**\r\n\r\n你有一个 $n$ 个节点的树，每条边有边权，有 $q$ 次更新，每次修改一条边的边权，并询问树的直径。\r\n\r\n本题强制在线。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行输入三个正整数 $n, q, w$，表示节点数，询问数，以及一条边权值的上限。\r\n\r\n接下来 $n - 1$ 行，其中第 $i$ 行三个整数 $a_i, b_i, c_i (1\\le a_i, b_i \\le n, 0\\le c_i < w)$，表示链接节点 $a_i, b_i$ 的一条边权值为 $c_i$。\r\n\r\n接下来 $q$ 行，每行两个整数 $d, e (0\\le d < n - 1, 0 \\le e < w)$，表示加密前的数据。\r\n\r\n记 $\\mathrm{last}$ 为上次询问的答案，第一次时为 $0$。解密后的数据为 $d' = (d + \\mathrm{last}) \\bmod (n - 1) + 1, e' = (e + \\mathrm{last}) \\bmod w$。表示将第 $d'$ 条边的权值修改为 $e'$。\r\n"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出 $q$ 行，每行一个整数，表示修改后的直径。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n\r\n```plain\r\n4 3 2000\r\n1 2 100\r\n2 3 1000\r\n2 4 1000\r\n2 1030\r\n1 1020\r\n1 890\r\n```\r\n\r\n#### 样例输出 1\r\n\r\n```plain\r\n2030\r\n2080\r\n2050\r\n```\r\n\r\n#### 样例解释 1\r\n这组样例如下图所示：\r\n![](https://codeforces.com/predownloaded/fc/c0/fcc0619d9037fb8adbd979b11708ff88fd4c3257.png)\r\n\r\n最左端图片是这棵树的初始状态，接下来的每张图表示在更新之后的情况。更改后的边权用绿色标记，直径用红色标记。\r\n\r\n第一个询问更改了第三条边的边权，即 $\\{2,4\\}$ 的边权改为 $1030$。两点间最大距离为 $2030$，即 $3$ 到 $4$ 的距离。\r\n\r\n因为第一个询问的答案为 $2030$，第二个询问为：\r\n\r\n$$\r\nd_2'=(1+2030)\\bmod 3=0\\\\\r\ne_2'=(1020+2030)\\bmod 2000=1050\\\\\r\n$$\r\n\r\n因此边 $\\{1,2\\}$ 的边权改为 $1050$，这使得从 $1$ 到 $4$ 的距离最大，距离为 $2080$。\r\n\r\n第三个询问为：\r\n\r\n$$\r\nd_3'=(1+2080)\\bmod 3=2\\\\\r\ne_3'=(890+2080)\\bmod 2000=970\\\\\r\n$$\r\n\r\n因此边 $\\{2,4\\}$ 的边权改为 $970$，这使得从 $1$ 到 $3$ 的距离最大，距离为 $2050$。\r\n\r\n#### 样例输入 2\r\n\r\n```plain\r\n10 10 10000\r\n1 9 1241\r\n5 6 1630\r\n10 5 1630\r\n2 6 853\r\n10 1 511\r\n5 3 760\r\n8 3 1076\r\n4 10 1483\r\n7 10 40\r\n8 2051\r\n5 6294\r\n5 4168\r\n7 1861\r\n0 5244\r\n6 5156\r\n3 3001\r\n8 5267\r\n5 3102\r\n8 3623\r\n```\r\n\r\n#### 样例输出 2\r\n\r\n```plain\r\n6164\r\n7812\r\n8385\r\n6737\r\n6738\r\n7205\r\n6641\r\n7062\r\n6581\r\n5155\r\n```\r\n"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于 $100\\%$ 的数据，保证 $2\\le n \\le 10^5, 1\\le q\\le 10^5, 1\\le w \\le 2\\times 10^{13}$。\r\n\r\n| 子任务编号 |          $n, q$   | $w$ | 特殊限制 | 分值 |\r\n| :--------: | :-----------------: | :---: | :---: | :--: |\r\n|    $1$     |     $\\le 10^2$       | $\\le 10^4$ | | $11$  |\r\n|    $2$     |     $\\le 5\\times 10^3$       | $\\le 10^4$ | | $13$  |\r\n|    $3$     |    $\\le 10^5$    | $\\le 10^4$ | 边的形式都为 $(1, i)$ | $7$  |\r\n|    $4$     |   $\\le 10^5$   | $\\le 10^4$ | 边的形式都为 $(i, 2i)$ 或 $(i, 2i + 1)$ | $18$  |\r\n|    $5$     |   $\\le 10^5$    | $\\le 2\\times 10^{13}$ | 保证有一条直径经过 $1$ 号节点 | $24$  |\r\n|    $6$     |   $\\le 10^5$    | $\\le 2\\times 10^{13}$ | | $27$  |\r\n"}]}