{"title":"「JOI 2020 Final」火灾","time_limit":1500,"memory_limit":256,"tags":["JOI","2020","树状数组","笛卡尔树 / Kruskal 重构树","数据结构"],"operation":{"submit":"https://loj.ac/problem/3256#submit_code","submissions":"https://loj.ac/submissions?problem_id=3256","statistics":"https://loj.ac/problem/3256/statistics/fastest","testdata":"https://loj.ac/problem/3256/testdata","discussion":"https://loj.ac/discussion/problem/3256"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**译自 [JOI 2020 Final](https://www.ioi-jp.org/joi/2019/2020-ho/index.html) T5「[火事](https://www.ioi-jp.org/joi/2019/2020-ho/2020-ho-t5.pdf) / [Fire](https://www.ioi-jp.org/joi/2019/2020-ho/2020-ho-t5-en.pdf)」**\r\n\r\n在 JOI 世界里有 $N$ 个地区排成一条线。为了方便，我们将这些地区编号为 $1$ 到 $N$。突然，各个地区都起火了。在时刻 $0$，第 $i$ 个区的火势大小为 $S_i$。\r\n\r\n此时（时刻 $0$），一阵风从 $1$ 号地区一直吹到了 $N$ 号地区。对于每两个相邻的地区，如果 $t$ 时刻上风地区的火势比下风地区的强，$t+1$ 时刻下风地区的火势大小将变为 $t$ 时刻上风地区的火势，否则 $t+1$ 和 $t$ 时刻时下风地区的火势大小不变。  \r\n形式化地说，如果 $t$ 时刻 $i$ 地区的火势为 $S_i(t)$，则 $S_i(t)=\\max\\{S_{i-1}(t-1),S_i(t-1)\\}$，其中 $S_0(t)=0,~S_i(0)=S_i$。\r\n\r\n你是一位消防员。现在，你想到了 $Q$ 种灭火方案，并打算执行其中一种。你的第 $j$ 种方案是在 $T_j$ 时刻对 $[L_j,~R_j]$ 中的所有地区使用灭火剂完全扑灭火灾。  \r\n对于一个火势大小为 $s$ 的城市，你将需要 $s$ 升的灭火剂来扑灭火灾。因此，执行方案 $j$ 总共要花费 $S_{L_j}(T_j)+S_{L_j+1}(T_j)+\\cdots +S_{R_j}(T_j)$ 升灭火剂。  \r\n*译者注：英文版题面中没有定义 $T_j$，此处定义从日文版中提取。*\r\n\r\n为了更好地选取灭火方案，你的任务是编写一个程序，给出 $0$ 时刻的火势大小，计算各个方案所需的灭火剂量。\r\n\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个数 $N,~Q$，含义如题面所示。  \r\n接下来一行 $N$ 个数 $S_1\\dots S_N$，表示初始时的火势大小。  \r\n接下来 $Q$ 行每行三个数 $T_j,~L_j,~R_j$，表示方案 $j$ 的相关信息。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出 $Q$ 行，第 $i$ 行表示方案 $j$ 所需的灭火剂量。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n5 5 \r\n9 3 2 6 5 \r\n1 1 3 \r\n2 1 5 \r\n3 2 5 \r\n4 3 3 \r\n5 3 5\r\n```\r\n#### 样例输出 1\r\n```plain\r\n21\r\n39\r\n33\r\n9\r\n27\r\n```\r\n#### 样例解释 1\r\n- 时刻 $0$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~3,~2,~6,~5$。\r\n- 时刻 $1$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~9,~3,~6,~6$。方案 $1$ 需要的灭火剂量为 $9+9+3=21$ 升。\r\n- 时刻 $2$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~9,~9,~6,~6$。方案 $2$ 需要的灭火剂量为 $9+9+9+6+6=39$ 升。\r\n- 时刻 $3$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~9,~9,~9,~6$。方案 $3$ 需要的灭火剂量为 $9+9+9+6=33$ 升。\r\n- 时刻 $4$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~9,~9,~9,~9$。方案 $4$ 需要的灭火剂量为 $9$ 升。\r\n- 时刻 $5$ 时地区 $1$ 到 地区 $N$ 的火势大小分别为 $9,~9,~9,~9,~9$。方案 $5$ 需要的灭火剂量为 $9+9+9=27$ 升。\r\n\r\n该样例满足子任务 $1$ 和子任务 $5$ 的限制。\r\n\r\n#### 样例输入 2\r\n```plain\r\n10 10 \r\n3 1 4 1 5 9 2 6 5 3 \r\n1 1 6 \r\n2 8 10 \r\n4 2 7 \r\n8 3 3 \r\n6 1 10 \r\n3 2 8 \r\n5 1 9 \r\n7 4 5 \r\n9 7 9 \r\n10 10 10\r\n```\r\n#### 样例输出2\r\n```plain\r\n28\r\n21\r\n34\r\n4\r\n64\r\n43\r\n55\r\n9\r\n27\r\n9\r\n```\r\n#### 样例解释 2\r\n该样例满足子任务 $1$ 和子任务 $5$ 的限制。\r\n\r\n#### 样例输入 3\r\n```plain\r\n10 10 3 \r\n1 4 1 5 9 2 6 5 3 \r\n1 6 6 \r\n2 8 8 \r\n4 2 2 \r\n8 3 3 \r\n6 1 1 \r\n3 4 4 \r\n5 5 5 \r\n7 10 10 \r\n9 8 8 \r\n10 7 7\r\n```\r\n#### 样例输出 3\r\n```plain\r\n9\r\n9\r\n3\r\n4\r\n3\r\n4\r\n5\r\n9\r\n9\r\n9\r\n```\r\n#### 样例解释 3\r\n该样例满足子任务 $1,~3,~5$ 的限制。\r\n\r\n#### 样例输入 4\r\n```plain\r\n10 10 \r\n3 1 4 1 5 9 2 6 5 3 \r\n7 1 6 \r\n7 8 10 \r\n7 2 7 \r\n7 3 3 \r\n7 1 10 \r\n7 2 8 \r\n7 1 9 \r\n7 4 5 \r\n7 7 9\r\n7 10 10\r\n```\r\n#### 样例输出 4\r\n```plain\r\n28\r\n27\r\n34\r\n4\r\n64\r\n43\r\n55\r\n9\r\n27\r\n9\r\n```\r\n#### 样例解释 4\r\n该样例满足子任务 $1,~2,~5$ 的限制。\r\n\r\n#### 样例输入 5\r\n```plain\r\n20 20 \r\n2 1 2 2 1 1 1 1 2 2 2 1 2 1 1 2 1 2 1 1 \r\n1 1 14 \r\n2 3 18 \r\n4 10 15 \r\n8 2 17 \r\n9 20 20 \r\n4 8 19 \r\n7 2 20 \r\n11 1 5 \r\n13 2 8 \r\n20 1 20 \r\n2 12 15 \r\n7 1 14 \r\n12 7 18 \r\n14 2 17 \r\n9 19 20 \r\n12 12 12 \r\n6 2 15 \r\n11 2 15 \r\n19 12 17 \r\n4 1 20\r\n```\r\n#### 样例输出 5\r\n```plain\r\n25\r\n30\r\n12\r\n32\r\n2\r\n24\r\n38\r\n10\r\n14\r\n40\r\n8\r\n28\r\n24\r\n32\r\n4\r\n2\r\n28\r\n28\r\n12\r\n40\r\n```\r\n#### 样例解释 5\r\n该样例满足子任务 $1,~4,~5$ 的限制。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有测试数据 $1\\le N,Q\\le 2\\times 10^5,~1\\le S_i\\le 10^9,~1\\le L_j,~R_j,~T_j\\le N$。\r\n\r\n|子任务编号|分值|具体限制|\r\n|:-:|:-:|:-:|\r\n|$1$|<!-- Please don't merge -->$1$|$1 \\le N,Q \\le 200$|\r\n|$2$|$6$|$T_1 = T_2 = \\ldots = T_Q$|\r\n|$3$|$7$|$L_j = R_j\\ (1 \\le j \\le Q)$|\r\n|$4$|$6$|$S_i \\le 2\\ (1 \\le i \\le N)$|\r\n|$5$|$80$||"}]}