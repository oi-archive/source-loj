{"title":"「ZJOI2020」传统艺能","time_limit":4000,"memory_limit":512,"tags":["ZJOI","2020","矩阵","概率与期望","DP"],"operation":{"submit":"https://loj.ac/problem/3312#submit_code","submissions":"https://loj.ac/submissions?problem_id=3312","statistics":"https://loj.ac/problem/3312/statistics/fastest","testdata":"https://loj.ac/problem/3312/testdata","discussion":"https://loj.ac/discussion/problem/3312"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"Bob 喜欢线段树。\r\n\r\n众所周知，ZJOI 的第二题有很多线段树。\r\n\r\nBob 有一棵根为 $[1, n]$ 的**广义线段树**。Bob 需要在这个线段树上执行 $k$ 次区间**懒标记**操作，每次操作会等概率地从 $[1, n]$ 的所有 $\\frac{n(n+1)}2$ 个子区间中随机选择一个。对于所有在该次操作中被访问到的非叶子节点，Bob 会将这个点上的标记下推；而对于所有叶子节点（即没有继续递\r\n归的节点），Bob 会给这个点打上标记。\r\n\r\nBob 想知道，$k$ 次操作之后，有标记的节点的期望数量是多少。\r\n\r\n#### 具体定义\r\n\r\n**线段树**：线段树是一棵每个节点上都记录了一个线段的二叉树。根节点记录的线段是 $[1, n]$。\r\n\r\n对于每个节点，若它记录的线段是 $[l, r]$ 且 $l\\neq r$，取 $m = \\lfloor \\frac{l+r}2 \\rfloor$，则它的左右儿子节点记录的线段分别是 $[l,m]$ 和 $[m + 1, r]$；若 $l = r$，则它是叶子节点。\r\n\r\n**广义线段树**：在广义的线段树中，$m$ 不要求恰好等于区间的中点，但是 $m$ 还是必须满足 $l\\le m < r$ 的。不难发现在广义的线段树中，树的深度可以达到 $O(n)$ 级别。\r\n\r\n线段树的核心是**懒标记**，下面是一个带懒标记的广义线段树的伪代码，其中 `tag` 数组为懒标记：\r\n\r\n![img](https://loj-img.upyun.menci.memset0.cn/2019/04/01/5ca213bd0a49e.png)\r\n\r\n注意，在处理叶子节点时，一旦他获得了一个标记，那么这个标记会一直存在。\r\n\r\n你也可以这么理解题意：有一棵广义线段树，每个节点有一个 $m$ 值。一开始 `tag` 数组均为 $0$，Bob 会执行 $k$ 次操作，每次操作等概率随机选择区间 $[l, r]$ 并执行 `MODIFY(root, 1, n, l, r);`。\r\n\r\n最后所有 `Node` 中满足 `tag[Node] = 1` 的期望数量就是需要求的值。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行输入两个整数 $n, k$。\r\n\r\n接下来输入一行包含 $n − 1$ 个整数 $a_i$：按照**先序遍历**的顺序，给出广义线段树上所有非叶子节点的划分位置 $m$。你也可以理解为从只有 $[1, n]$ 根节点开始，每次读入一个整数后，就将当前包含这个整数的节点做一次拆分，最后获得一棵有 $2n − 1$ 个节点的广义线段树。\r\n\r\n保证给定的 $n − 1$ 个整数是一个排列，不难发现通过这些信息就能唯一确定一棵 $[1, n]$ 上的广义线段树。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出一行一个整数，代表期望数量对 $p = 998244353$ 取模后的结果。即，如果期望数量的最简分数表示为 $\\frac ab$，你需要输出一个整数 $c$ 满足 $c\\times b \\equiv a \\pmod p$。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n\r\n```plain\r\n3 1\r\n1 2\r\n```\r\n\r\n#### 样例输出 1\r\n\r\n```\r\n166374060\r\n```\r\n\r\n#### 样例解释 1\r\n\r\n输入的线段树为 $[1, 3], [1, 1], [2, 3], [2, 2], [3, 3]$。\r\n\r\n若操作为 $[1, 1]/[2, 2]/[3, 3]/[2, 3]/[1, 3]$，标记个数为 $1$。若操作为 $[1, 2]$，标记个数为 $2$。故答案为 $\\frac 76$。\r\n\r\n#### 样例输入 2\r\n\r\n```plain\r\n5 4\r\n2 1 3 4\r\n```\r\n\r\n#### 样例输出 2\r\n\r\n```plain\r\n320443836\r\n```\r\n\r\n#### 样例 3\r\n\r\n见附加文件中 `segment3.in` 与 `segment3.out`。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"| 测试点 |     $n$      |    $k$    |              其他约定               |\r\n| :----: | :----------: | :-------: | :---------------------------------: |\r\n|  $1$   |   $\\le 10$   |  $\\le 4$  |                                     |\r\n|  $2$   |   $\\le 10$   | $\\le 100$ |                                     |\r\n|  $3$   |   $\\le 5$    |           |                                     |\r\n|  $4$   |              |   $=1$    |                                     |\r\n|  $5$   |    $=32$     |           |      输入的线段树为完全二叉树       |\r\n|  $6$   |    $=64$     |           |      输入的线段树为完全二叉树       |\r\n|  $7$   |   $=4096$    |           |      输入的线段树为完全二叉树       |\r\n|  $8$   |  $\\le 5000$  |           | 每个 $m$ 均在 $[l, r-1]$ 内均匀随机 |\r\n|  $9$   | $\\le 100000$ |           |                                     |\r\n|  $10$  |              |           |                                     |\r\n\r\n对于 $100\\%$ 的数据，$1\\le n\\le 200000, 1\\le k\\le 10^9$。\r\n\r\n"}]}