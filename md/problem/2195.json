{"title":"「SDOI2014」旅行","time_limit":1000,"memory_limit":256,"tags":["SDOI","2014","线段树","树链剖分","数据结构"],"operation":{"submit":"https://loj.ac/problem/2195#submit_code","submissions":"https://loj.ac/submissions?problem_id=2195","statistics":"https://loj.ac/problem/2195/statistics/fastest","testdata":"https://loj.ac/problem/2195/testdata","discussion":"https://loj.ac/discussion/problem/2195"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"S 国有 $N$ 个城市，编号从 $1$ 到 $N$。城市间用 $N-1$ 条双向道路连接，满足从一个城市出发可以到达其它所有城市。每个城市信仰不同的宗教，如飞天面条神教、隐形独角兽教、绝地教都是常见的信仰。为了方便，我们用不同的正整数代表各种宗教，S 国境内总共有 $C$ 种不同的宗教。\r\n\r\nS 国的居民常常旅行。旅行时他们总会走最短路，并且为了避免麻烦，只在信仰和他们相同的城市留宿。当然旅程的终点也是信仰与他相同的城市。S 国政府为每个城市标定了不同的旅行评级，旅行者们常会记下途中（包括起点和终点）留宿过的城市的评级总和或最大值。\r\n\r\n在 S 国的历史上常会发生以下几种事件：\r\n1. ``CC x c``：城市 $x$ 的居民全体改信了 $c$ 教；\r\n2. ``CW x w``：城市 $x$ 的评级调整为 $w$；\r\n3. ``QS x y``：一位旅行者从城市 $x$ 出发，到城市 $y$，并记下了途中留宿过的城市的评级总和；\r\n4. ``QM x y``：一位旅行者从城市 $x$ 出发，到城市 $y$，并记下了途中留宿过的城市的评级最大值。\r\n\r\n由于年代久远，旅行者记下的数字已经遗失了，但记录开始之前每座城市的信仰与评级，还有事件记录本身是完好的。请根据这些信息，还原旅行者记下的数字。  \r\n为了方便，我们认为事件之间的间隔足够长，以致在任意一次旅行中，所有城市的评级和信仰保持不变。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"输入的第一行包含整数 $N$，$Q$ 依次表示城市数和事件数。  \r\n接下来 $N$ 行，第 $i+1$ 行两个整数 $W_i$，$C_i$ 依次表示记录开始之前，城市 $i$ 的评级和信仰。  \r\n接下来 $N-1$ 行每行两个整数 $x$，$y$ 表示一条双向道路。  \r\n接下来 $Q$ 行，每行一个操作，格式如上所述。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对每个 ``QS`` 和 ``QM`` 事件，输出一行，表示旅行者记下的数字。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n5 6\r\n3 1\r\n2 3\r\n1 2\r\n3 3\r\n5 1\r\n1 2\r\n1 3\r\n3 4\r\n3 5\r\nQS 1 5\r\nCC 3 1\r\nQS 1 5\r\nCW 3 3\r\nQS 1 5\r\nQM 2 4\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n8\r\n9\r\n11\r\n3\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对所有的数据，$N, Q \\leq 10^5,\\ C \\leq 10^5$，对所有 ``QS`` 和 ``QM`` 事件，起点和终点城市的信仰相同；在任意时刻，城市的评级总是不大于 $10^4$ 的正整数，且宗教值不大于 $C$。"}]}