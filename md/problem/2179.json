{"title":"「BJOI2017」树的难题","time_limit":2000,"memory_limit":256,"tags":["2017","BJOI","线段树","点分治","数据结构"],"operation":{"submit":"https://loj.ac/problem/2179#submit_code","submissions":"https://loj.ac/submissions?problem_id=2179","statistics":"https://loj.ac/problem/2179/statistics/fastest","testdata":"https://loj.ac/problem/2179/testdata","discussion":"https://loj.ac/discussion/problem/2179"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"给你一棵 $n$ 个点的无根树。\r\n\r\n树上的每条边具有颜色。一共有 $m$ 种颜色，编号为 $1$ 到 $m$，第 $i$ 种颜色的权值为 $c_i$。\r\n\r\n对于一条树上的简单路径，路径上经过的所有边按顺序组成一个颜色序列，序列可以划分成若干个相同颜色段。定义路径权值为颜色序列上每个同颜色段的颜色权值之和。\r\n\r\n请你计算，经过边数在 $l$ 到 $r$ 之间的所有简单路径中，路径权值的最大值。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行，四个整数 $n, m, l, r$。  \r\n第二行，$m$ 个整数 $c_1, c_2, \\ldots, c_m$，由空格隔开，依次表示每个颜色的权值。  \r\n接下来 $n-1$ 行，每行三个整数 $u, v, c$，表示点 $u$ 和点 $v$ 之间有一条颜色为 $c$ 的边。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出一行，一个整数，表示答案。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n5 3 1 4\r\n-1 -5 -2\r\n1 2 1\r\n1 3 1\r\n2 4 2\r\n2 5 3\r\n```\r\n#### 样例输出 1\r\n```plain\r\n-1\r\n```\r\n#### 样例解释 1\r\n颜色权值均为负，最优路径为 $(1, 2)$ 或 $(1, 3)$。\r\n#### 样例输入 2\r\n```plain\r\n8 4 3 4\r\n-7 9 6 1\r\n1 2 1\r\n1 3 2\r\n1 4 1\r\n2 5 1\r\n5 6 2\r\n3 7 1\r\n3 8 3\r\n```\r\n#### 样例输出 2\r\n```plain\r\n11\r\n```\r\n#### 样例解释 2\r\n最优路径为 $(3, 1, 2, 5, 6)$，其颜色序列为 $(2, 1, 1, 2)$。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"<!-- BEGIN: Migrated markdown table -->\n\n| 测试点编号 | $n$ | $m$ | 特殊限制 |\n|-|-|-|-|\n| $1$ | $=10^3$ | $\\le n$ | 无特殊限制 |\n| $2$ | $=10^4$ | $=2$ | 无特殊限制 |\n| $3$ | $=10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $4$ | $=2\\times10^5$ | $\\le n$ | 所有点的度数不超过 $2$ |\n| $5$ | $=10^5$ | $=10$ | $l=1$，$r=n-1$ |\n| $6$ | $=2\\times10^5$ | $\\le n$ | $l=1$，$r=n-1$ |\n| $7$ | $=10^5$ | $=50$ | 无特殊限制 |\n| $8$ | $=10^5$ | $\\le n$ | 无特殊限制 |\n| $9$ | $=2\\times 10^5$ | $=100$ | 无特殊限制 |\n| $10$ | $=2\\times 10^5$ | $\\le n$ | 无特殊限制 |\n\n<!-- Migrated from original HTML table:\n<table class=\"ui center aligned table\">\r\n<thead>\r\n<tr><th>测试点编号</th><th> $n$ </th><th> $m$ </th><th>特殊限制</th></tr>\r\n</thead>\r\n<tbody>\r\n<tr><td> $1$ </td><td> $=10^3$ </td><td> $\\le n$ </td><td rowspan=\"2\"> 无特殊限制 </td></tr>\r\n<tr><td> $2$ </td><td> $=10^4$ </td><td> $=2$ </td></tr>\r\n<tr><td> $3$ </td><td> $=10^5$ </td><td rowspan=\"2\"> $\\le n$ </td><td rowspan=\"2\"> 所有点的度数不超过 $2$ </td></tr>\r\n<tr><td> $4$ </td><td> $=2\\times10^5$ </td></tr>\r\n<tr><td> $5$ </td><td> $=10^5$ </td><td> $=10$ </td><td rowspan=\"2\"> $l=1$，$r=n-1$ </td></tr>\r\n<tr><td> $6$ </td><td> $=2\\times10^5$ </td><td> $\\le n$ </td></tr>\r\n<tr><td> $7$ </td><td rowspan=\"2\"> $=10^5$ </td><td> $=50$ </td><td rowspan=\"4\"> 无特殊限制 </td></tr>\r\n<tr><td> $8$ </td><td> $\\le n$ </td></tr>\r\n<tr><td> $9$ </td><td rowspan=\"2\"> $=2\\times 10^5$ </td><td> $=100$ </td></tr>\r\n<tr><td> $10$ </td><td> $\\le n$ </td></tr>\r\n</tbody>\r\n</table>\n-->\n\n<!-- END: Migrated markdown table -->"}]}