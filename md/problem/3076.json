{"title":"「2019 集训队互测 Day 3」公园","time_limit":4000,"memory_limit":1024,"tags":["集训队互测","2019","线段树","树链剖分"],"operation":{"submit":"https://loj.ac/problem/3076#submit_code","submissions":"https://loj.ac/submissions?problem_id=3076","statistics":"https://loj.ac/problem/3076/statistics/fastest","testdata":"https://loj.ac/problem/3076/testdata","discussion":"https://loj.ac/discussion/problem/3076"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"<div class=\"ui message\">\r\n小Q是一名设计师，她主导着一个公园的设计。她已经设计好了每个景点的位置、内容，以及景点之间的路线。但是，对于如何设置景点周围的环境（主题），她就犯了难，因为对于有些道路，若两端的景点主题不一致，过渡会显得太突兀；对于另一些道路，若两端的景点一致，又会显得太单调；而且根据景点的内容，不同景点适合使用的主题也可能不同。她想通过一个程序来计算决定，哪些景点周围使用西部主题，哪些景点周围使用科幻主题，然而小Q的编程能力有限，所以她想让你帮忙解决这个问题。\r\n</div>\r\n\r\n公园有 $n$ 个景点，$m$ 条连接两个景点的无向道路。第 $i$ 条道路连接第 $x_i$ 和第 $y_i$ 个景点。  \r\n若第 $i$ 条道路两端的景点主题相同，可以得到 $c_i$ 的美观度；若第 $i$ 条道路两端的景点主题不同，可以得到 $d_i$ 的美观度。  \r\n第 $i$ 个景点使用西部主题可以得到 $w_i$ 的美观度，使用科幻主题可以得到 $s_i$ 的美观度。\r\n\r\n公园的线路图是小Q精心设计的，小Q保证她设计的公园中从任意一个景点出发，能够到达所有的景点；保证每条道路连接的是两个不同的景点；保证没有两条不同的道路连接同一对景点；并且对于任意四个景点 $A,B,C,D$ ，都不能找到六条两两没有公共边的路径，分别连接四个景点中的每一对景点—— $AB,AC,AD,BC,BD,CD$ 。\r\n\r\n以下给出一些**一定不是**小Q设计的公园线路图的例子：\r\n\r\n|<img width=\"200px\" src=\"https://loj-img.upyun.menci.memset0.cn/2019/04/30/5cc7e6ce34579.png\" alt=\"graph1.png\" title=\"graph1.png\" />|<img width=\"200px\" src=\"https://loj-img.upyun.menci.memset0.cn/2019/04/30/5cc7e6cda61a8.png\" alt=\"graph2.png\" title=\"graph2.png\" />\r\n|:-:|:-:|\r\n|从 $1$ 号节点出发不能到达 $3$ 号节点|对于第 $1,4,5,6$ 号景点，存在六条两两没有公共边的路径：<br/>$1\\rightarrow4$，$4\\rightarrow5$，$5\\rightarrow6$，$6\\rightarrow1$，$4\\rightarrow3\\rightarrow6$，$1\\rightarrow2\\rightarrow5$ 连接这四个景点的每一对景点|\r\n\r\n你需要把每个景点的主题设定为科幻主题和西部主题中的一种，使得所有景点以及道路的美观度之和最大。\r\n\r\n小Q可能会通过重新计算来修改某个景点的 $w_i$ 和 $s_i$ 的值或者某条道路的 $c_i$ 和 $d_i$ 的值。她会修改 $Q$ 次，你需要在修改之前以及每一次修改之后输出最优方案的美观度之和。注意修改与修改之间**不是**互相独立的。\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个正整数 $n,m$ 。\r\n\r\n接下来 $n$ 行，每行两个非负整数，其中第 $i$ 行表示 $w_i,s_i$ 。\r\n\r\n接下来 $m$ 行，每行四个正整数，其中第 $i$ 行表示 $x_i,y_i,c_i,d_i$ 。\r\n\r\n第 $n+m+2$ 行一个非负整数 $Q$ 。\r\n\r\n接下来 $Q$ 行，每行三个正整数 $x,a,b$ ，若 $x \\le n$ 则表示小Q把 $w_x$ 改为 $a$ ，把 $s_x$ 改为 $b$ ；若 $n < x \\le n+m$ 则表示小Q把 $c_{x-n}$ 改为 $a$ ，把 $d_{x-n}$ 改为 $b$ 。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出 $Q+1$ 行，每行一个正整数，第 $1$ 行表示所有修改之前的答案，第 $i+1(1 \\le i \\le Q)$ 行表示第 $i$ 次修改之后的答案。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例 1 输入\r\n\r\n```\r\n2 1\r\n2 3\r\n4 7\r\n1 2 5 7\r\n1\r\n1 2 6\r\n```\r\n\r\n#### 样例 1 输出\r\n\r\n```\r\n16\r\n18\r\n```\r\n\r\n#### 样例 1 解释\r\n\r\n公园的线路图如图所示。\r\n\r\n<center><img width=\"200px\" src=\"https://loj-img.upyun.menci.memset0.cn/2019/04/30/5cc7e6cde8c28.png\" alt=\"graph3.png\" title=\"graph3.png\" /></center>\r\n\r\n修改之前，最优方案为 $1$ 号景点使用西部主题，$2$ 号景点使用科幻主题，美观度之和为 $2+7+7=16$ 。\r\n\r\n修改之后，最优方案为 $1$ 号景点使用科幻主题，$2$ 号景点使用科幻主题，美观度之和为 $6+7+5=18$ 。\r\n\r\n#### 样例 2 输入\r\n\r\n```\r\n5 6\r\n4 8\r\n5 2\r\n3 7\r\n5 3\r\n4 9\r\n1 2 3 8\r\n1 3 7 4\r\n2 3 9 2\r\n2 4 7 9\r\n1 5 4 9\r\n3 5 6 4\r\n4\r\n4 2 6\r\n9 6 3\r\n7 4 2\r\n2 8 5\r\n```\r\n\r\n#### 样例 2 输出\r\n\r\n```72\r\n72\r\n71\r\n70\r\n68\r\n71\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"保证 $2\\le n \\le 100000,Q \\le 100000$；$x_i,y_i \\le n$ ，$x \\le n+m$ ，$s_i,w_i,c_i,d_i,a,b \\le 10^6$。保证线路图是小Q设计的。\r\n\r\n按照常理，公园是有出入口的。但是在本题中，你可以认为公园的出入口也是景点。\r\n\r\n定义环路为起点和终点相同，并且中间（即除起点终点外）不经过重复景点的路径上道路的集合。\r\n\r\n* 子任务 $1$（$2$ 分）：$Q=0$，$m=n-1$；\r\n* 子任务 $2$（$3$ 分）：$n \\le 17$，$Q\\le 17$；\r\n* 子任务 $3$（$7$ 分）：$Q=0$，每条道路最多属于一个环路；\r\n* 子任务 $4$（$5$ 分）：$Q=0$；\r\n* 子任务 $5$（$13$ 分）：$n,Q \\le 1000$；\r\n* 子任务 $6$（$19$ 分）：$s_i=w_i=0$，$x > n$，每条道路最多属于一个环路；\r\n* 子任务 $7$（$17$ 分）：$s_i=w_i=0$，$x > n$；\r\n* 子任务 $8$（$23$ 分）：$m=n-1$；\r\n* 子任务 $9$（$11$ 分）：无特殊限制。"}]}