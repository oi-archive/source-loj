{"title":"「THUWC 2017」在美妙的数学王国中畅游","time_limit":2000,"memory_limit":512,"tags":["2017","THUWC","Link-Cut Tree","Taylor 展开","数据结构","数学","Special Judge"],"operation":{"submit":"https://loj.ac/problem/2289#submit_code","submissions":"https://loj.ac/submissions?problem_id=2289","statistics":"https://loj.ac/problem/2289/statistics/fastest","testdata":"https://loj.ac/problem/2289/testdata","discussion":"https://loj.ac/discussion/problem/2289"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"数字和数学规律主宰着这个世界。\r\n\r\n机器的运转，\r\n\r\n生命的消长，\r\n\r\n宇宙的进程，\r\n\r\n这些神秘而又美妙的过程无不可以用数学的语言展现出来。\r\n\r\n这印证了一句古老的名言：\r\n\r\n“学好数理化，走遍天下都不怕。”\r\n\r\n学渣小R被大学的数学课程虐得生活不能自理，微积分的成绩曾是他在教室里上的课的最低分。然而他的某位陈姓室友却能轻松地在数学考试中得到满分。为了提升自己的数学课成绩，有一天晚上（在他睡觉的时候），他来到了数学王国。\r\n\r\n数学王国中，每个人的智商可以用一个属于 $[0,1]$ 的实数表示。数学王国中有 $n$ 个城市，编号从 $0$ 到 $n-1$ ，这些城市由若干座魔法桥连接。每个城市的中心都有一个魔法球，每个魔法球中藏有一道数学题。每个人在做完这道数学题之后都会得到一个在 $[0,1]$ 区间内的分数。一道题可以用一个从 $[0,1]$ 映射到 $[0,1]$ 的函数 $f(x)$ 表示。若一个人的智商为 $x$ ，则他做完这道数学题之后会得到 $f(x)$ 分。函数 $f$ 有三种形式：\r\n\r\n-  正弦函数 $\\sin(a x + b)\\ (a \\in [0,1], b \\in [0,\\pi],a+b\\in[0,\\pi])$\r\n\r\n-  指数函数 $e^{ax+b}\\ (a\\in [-1,1], b\\in [-2,0], a+b\\in [-2,0])$\r\n\r\n-  一次函数 $ax + b\\ (a\\in [-1,1],b\\in[0,1],a+b\\in [0,1])$ \r\n\r\n数学王国中的魔法桥会发生变化，有时会有一座魔法桥消失，有时会有一座魔法桥出现。但在任意时刻，只存在至多一条连接任意两个城市的简单路径（即所有城市形成一个森林）。在初始情况下，数学王国中不存在任何的魔法桥。\r\n\r\n数学王国的国王拉格朗日很乐意传授小R数学知识，但前提是小R要先回答国王的问题。这些问题具有相同的形式，即一个智商为 $x$ 的人从城市 $u$ 旅行到城市 $v$ （即经过 $u$ 到 $v$ 这条路径上的所有城市，包括 $u$ 和 $v$ ）且做了所有城市内的数学题后，他所有得分的总和是多少。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个正整数 $n,m$ 和一个字符串 $type$ 。表示数学王国中共有 $n$ 座城市，发生了 $m$ 个事件，该数据的类型为 $type$ 。 $type$ 字符串是为了能让大家更方便地获得部分分，你可能不需要用到这个输入。其具体含义在**【数据范围与提示】**中有解释。\r\n\r\n接下来 $n$ 行，第 $i$ 行表示初始情况下编号为 $i$ 的城市的魔法球中的函数。一个魔法用一个整数 $f$ 表示函数的类型，两个实数 $a,b$ 表示函数的参数，若\r\n\r\n-  $f=1$ ,则函数为 $f(x)=\\sin(ax+b)(a \\in [0,1], b \\in [0,\\pi],a+b\\in[0,\\pi])$\r\n-  $f=2$ ,则函数为 $f(x)=e^{ax+b}(a\\in[-1,1],b\\in[-2,0],a+b\\in[-2,0])$\r\n- $f=3$ ,则函数为 $f(x)=ax+b(a\\in[-1,1],b\\in[0,1],a+b\\in[0,1])$\r\n\r\n接下来 $m$ 行，每行描述一个事件，事件分为四类。\r\n\r\n-  `appear u v` 表示数学王国中出现了一条连接 $u$ 和 $v$ 这两座城市的魔法桥 $(0\\le u,v < n, u\\ne v)$ ，保证连接前 $u$ 和 $v$ 这两座城市不能互相到达。\r\n-  `disappear u v` 表示数学王国中连接 $u$ 和 $v$ 这两座城市的魔法桥消失了，保证这座魔法桥是存在的。\r\n-  `magic c f a b` 表示城市 $c$ 的魔法球中的魔法变成了类型为 $f$ ，参数为 $a,b$ 的函数\r\n-  `travel u v x` 表示询问一个智商为 $x$ 的人从城市 $u$ 旅行到城市 $v$ （即经过 $u$ 到 $v$ 这条路径上的所有城市，包括 $u$ 和 $v$ ）后，他得分的总和是多少。若无法从 $u$ 到达 $v$ ，则输出一行一个字符串 `unreachable`。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于每个询问，输出一行实数，表示得分的总和。\r\n\r\n"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n3 7 C1\r\n1 1 0\r\n3 0.5 0.5\r\n3 -0.5 0.7\r\nappear 0 1\r\ntravel 0 1 0.3\r\nappear 0 2\r\ntravel 1 2 0.5\r\ndisappear 0 1\r\nappear 1 2\r\ntravel 1 2 0.5\r\n\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n9.45520207e-001\r\n1.67942554e+000\r\n1.20000000e+000\r\n\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"#### 【小R教你学数学】\r\n\r\n若函数 $f(x)$ 的 $n$ 阶导数在 $[a,b]$ 区间内连续，则对 $f(x)$ 在 $x_0(x_0\\in[a,b])$ 处使用 $n$ 次拉格朗日中值定理可以得到带拉格朗日余项的泰勒展开式\r\n\r\n $f(x)=f(x_0)+\\frac{f'(x_0)(x-x_0)}{1!}+\\frac{f''(x_0)(x-x_0)^2}{2!}+ \\cdots +\\frac{f^{(n-1)}(x_0)(x-x_0)^{n-1}}{(n-1)!}+\\frac{f^{(n)}(\\xi)(x-x_0)^n}{n!},x\\in[a,b]$\r\n\r\n其中，当 $x>x_0$ 时，$\\xi\\in[x_0,x]$。当 $x<x_0$ 时，$\\xi\\in[x,x_0]$。\r\n\r\n$f^{(n)}$表示函数 $f$ 的 $n$ 阶导数\r\n\r\n#### 【数据范围】\r\n\r\n对于 $100\\%$ 的数据，$1\\leq n \\leq 100000, 1\\leq m \\leq 200000$ 。\r\n\r\n本题共有20个数据点，每个数据点5分。\r\n\r\n对于 $5\\%$ 的数据，$n\\le 100,m\\le 2000$，数据类型为`C1`；  \r\n对于另外 $20\\%$ 的数据，数据类型为`A0`；  \r\n对于另外 $5\\%$ 的数据，数据类型为`B0`；  \r\n对于另外 $10\\%$ 的数据，数据类型为`D0`；  \r\n对于另外 $30\\%$ 的数据，数据类型为`A1`；  \r\n对于另外 $15\\%$ 的数据，数据类型为`C1`；  \r\n\r\n\r\n数据类型的含义：\r\n\r\nA：不存在 `disappear` 事件，且所有`appear`事件中的 $u=v-1$\r\n\r\nB：不存在 `disappear` 事件\r\n\r\nC：所有的 `travel` 事件经过的城市总数 $\\leq 5000000$（不可到达的城市对不计入在内）\r\n\r\nD：无限制\r\n\r\n0：所有 `travel` 事件中，$x=1$（即所有人的智商均为 $1$ ）\r\n\r\n1：无限制\r\n\r\n\r\n\r\n#### 【评分标准】\r\n\r\n如果你的答案与标准答案的相对误差在 $10^{-7}$ 以内或绝对误差在 $10^{-7}$ 以内，则被判定为正确。\r\n\r\n如果你的所有答案均为正确，则得满分，否则得0分。\r\n\r\n请注意输出格式：每行输出一个答案，答案只能为 `unreachable` 或者一个实数（建议使用科学计数法表示）。每行的长度不得超过50。错误输出格式会被判定为0分。\r\n\r\n\r\n"}]}