{"title":"「AHOI / HNOI2017」影魔","time_limit":2000,"memory_limit":512,"tags":["2017","HNOI","AHOI","线段树","离线","数据结构"],"operation":{"submit":"https://loj.ac/problem/2019#submit_code","submissions":"https://loj.ac/submissions?problem_id=2019","statistics":"https://loj.ac/problem/2019/statistics/fastest","testdata":"https://loj.ac/problem/2019/testdata","discussion":"https://loj.ac/discussion/problem/2019"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"影魔，奈文摩尔，据说有着一个诗人的灵魂。事实上，他吞噬的诗人灵魂早已成千上万。千百年来，他收集了各式各样的灵魂，包括诗人、牧师、帝王、乞丐、奴隶、罪人，当然，还有英雄。\r\n\r\n每一个灵魂，都有着自己的战斗力，而影魔，靠这些战斗力提升自己的攻击。\r\n\r\n奈文摩尔有 $n$ 个灵魂，他们在影魔宽广的体内可以排成一排，从左至右标号 $1$ 到 $n$。第 $i$ 个灵魂的战斗力为 $k_i$，灵魂们以点对的形式为影魔提供攻击力，对于灵魂对 $i, j(i<j)$ 来说，若不存在 $k_s(i<s<j)$ 大于 $k_i$ 或者 $k_j$，则会为影魔提供 $p_1$ 的攻击力（可理解为：当 $j = i + 1$ 时，因为不存在满足 $i < s < j$ 的 $s$，从而 $k_s$ 不存在，这时提供 $p_1$ 的攻击力；当 $j > i + 1$ 时，若 $\\max\\{k_s | i < s < j\\}\\le \\min(k_i, k_j)$，则提供 $p_1$ 的攻击力）；另一种情况，令 $c$ 为 $k_{i + 1}, k_{i + 2}, \\cdots, k_{j -1}$ 的最大值，若 $c$ 满足：$k_i < c < k_j$，或者 $k_j < c < k_i$，则会为影魔提供 $p_2$ 的攻击力，当这样的 $c$ 不存在时，自然不会提供这 $p_2$ 的攻击力；其他情况的点对，均不会为影魔提供攻击力。\r\n\r\n影魔的挚友噬魂鬼在一天造访影魔体内时被这些灵魂吸引住了，他想知道，对于任意一段区间 $[a,b]$，位于这些区间中的灵魂对会为影魔提供多少攻击力，即考虑所有满足 $a\\le i<j\\le b$ 的灵魂对 $i, j$ 提供的攻击力之和。\r\n\r\n顺带一提，灵魂的战斗力组成一个 $1$ 到 $n$ 的排列：$k_1, k_1, \\cdots, k_n$。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行四个整数 $n,m,p_1,p_2$；  \r\n第二行 $n$ 个整数数：$k_1, k_2,\\cdots, k_n$；  \r\n接下来 $m$ 行,每行两个数 $a,b$，表示询问区间 $[a,b]$ 中的灵魂对会为影魔提供多少攻击力。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"共输出 $m$ 行，每行一个答案，依次对应 $m$ 个询问。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n10 5 2 3\r\n7 9 5 1 3 10 6 8 2 4\r\n1 7\r\n1 9\r\n1 3\r\n5 9\r\n1 5\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n30\r\n39\r\n4\r\n13\r\n16\r\n```\r\n"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于 $30\\%$ 的数据，$1\\le n, m\\le 500$；  \r\n另有 $30\\%$ 的数据，$p_1 = 2p_2$；  \r\n对于 $100\\%$ 的数据，$1\\le n,m\\le 200000, 1\\le p_1, p_2\\le 1000$。"}]}