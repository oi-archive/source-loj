{"title":"「清华集训 2017」简单数据结构","time_limit":3000,"memory_limit":1024,"tags":["2017","清华集训","数据结构","DP"],"operation":{"submit":"https://loj.ac/problem/2326#submit_code","submissions":"https://loj.ac/submissions?problem_id=2326","statistics":"https://loj.ac/problem/2326/statistics/fastest","testdata":"https://loj.ac/problem/2326/testdata","discussion":"https://loj.ac/discussion/problem/2326"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"参加完 IOI2018 之后就是姚班面试。而你，由于讨厌物理、并且想成为乔布斯一样的创业家，被成功踢回贵系。\r\n\r\n转眼，时间的指针被指向 2019，大二，12 月初，考试周。\r\n\r\n你早听学长说，数据结构期中考很难，对竞赛生不友好，集训队选手做不完卷子。\r\n\r\n你冷笑。哼，堂堂国际金，这点难度的考试算什么。\r\n\r\n两小时，你看完习题解析前五章所有内容，并且倒背如流；\r\n\r\n一小时，你看了 500 页的讲义，并且记忆犹新；\r\n\r\n十分钟，你骑车到考场，自信的你只带了一把水笔，虽然考试让带资料；\r\n\r\n现在，摊开传说中神级卷子，你定神一看——\r\n\r\n给出一个长度为 $N$ 的序列 $A_{1},A_{2},\\cdots,A_{N}$ ，如果 $A$ 中的一个子序列 $B_1,B_2,\\cdots,B_M$，满足条件：\r\n\r\n- $1\\le M\\le N$\r\n- $\\forall 1\\le i<M$，$B_i\\Big{|}B_{i+1}$\r\n\r\n那么称 $B$ 为 $A$ 的`上升倍数子序列`。\r\n\r\n现在有一个长度为 $N$ 的序列 $A$ 被初始化为 $A_{1},A_{2},\\cdots,A_{N}$，以及 $Q$ 次对序列 $A$ 的操作。此处要求实现如下四种操作：\r\n\r\n- `0 x`：在序列 $A$ 的最左端插入一个数字 $x$；\r\n- `1 x`：在序列 $A$ 的最右端插入一个数字 $x$；\r\n- `2`：移除序列 $A$ 最左端的一个数字；\r\n- `3`：移除序列 $A$ 最右端的一个数字；\r\n\r\n在初始化序列 $A$ 和**每次**操作之后，请计算此时序列 $A$ 中**最长**上升倍数子序列的长度 $\\mathrm{MaxLen}$，以及所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，输出 $\\mathrm{MaxLen}$ 和 $\\mathrm{Cnt}$。\r\n\r\n为了大幅度降低题目难度，保证在**任意时刻**序列 $A$ **非空**，其中的元素**互不相等**，并且均为 $1\\sim M$ 之间的正整数；同一个数字最多只会被插入 $C$ 次。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"输入第一行包含三个正整数 $N,M,Q$，具体含义见上，保证 $1\\le N \\le 10^5$，$N\\le M \\le 10^6$，$0\\le Q \\le 10^5$；\r\n\r\n输入第二行包含 $N$ 个正整数，为 $A_1,A_2,\\cdots,A_N$，保证 $1\\le A_i\\le M$，并且序列 $A$ 中的元素互不相等；\r\n\r\n接下来共 $Q$ 行输入，每行输入格式形如`0 x`或者`1 x`或者`2`或者`3`，具体含义见上。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出共 $Q+1$ 行，在初始化和每次对序列 $A$ 操作后，输出 $A$ 中最长上升倍数子序列的长度 $\\mathrm{MaxLen}$ 和所有长度为 $\\mathrm{MaxLen}$ 的上升倍数子序列的不同的开头数 $\\mathrm{Cnt}$，用一个空格隔开。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n5 10 10\r\n1 2 5 9 10\r\n2\r\n1 7\r\n3\r\n3\r\n0 8\r\n3\r\n2\r\n1 8\r\n3\r\n0 3\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n3 1\r\n2 2\r\n2 2\r\n2 2\r\n1 3\r\n1 4\r\n1 3\r\n1 2\r\n2 1\r\n1 2\r\n1 3\r\n```\r\n\r\n#### 样例解释\r\n\r\n表格中以`//`隔开不同开头的最长上升子序列。\r\n\r\n<!-- BEGIN: Migrated markdown table -->\r\n\r\n| 操作次数 | $A$ | 输出答案 | 可能的解释 |\r\n|:-:|:-:|:-:|:-:|\r\n| 0 | 1 2 5 9 10 | 3 1 | 1 2 10 |\r\n| 1 | 2 5 9 10 | 2 2 | 2 10//5 10 |\r\n| 2 | 2 5 9 10 7 | 2 2 | 2 10//5 10 |\r\n| 3 | 2 5 9 10 | 2 2 | 2 10//5 10 |\r\n| 4 | 2 5 9 | 1 3 | 2//5//9 |\r\n| 5 | 8 2 5 9 | 1 4 | 2//5//8//9 |\r\n| 6 | 8 2 5 | 1 3 | 2//5//8 |\r\n| 7 | 2 5 | 1 2 | 2//5 |\r\n| 8 | 2 5 8 | 2 1 | 2 8 |\r\n| 9 | 2 5 | 1 2 | 2//5 |\r\n| 10 | 3 2 5 | 1 3 | 2//3//5 |\r\n\r\n<!-- Migrated from original HTML table:\r\n<table class='ui table'>\r\n    <thead>\r\n        <tr>\r\n            <th style='text-align: center'> 操作次数 </th>\r\n            <th style='text-align: center'> $A$ </th>\r\n            <th style='text-align: center'> 输出答案 </th>\r\n            <th style='text-align: center'> 可能的解释 </th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 0 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 2 5 9 10 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 3 1 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 2 10 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 9 10 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 10//5 10 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 9 10 7 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 10//5 10 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 3 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 9 10 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 10//5 10 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 4 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 9 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 3 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//5//9 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 8 2 5 9 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 4 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//5//8//9 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 6 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 8 2 5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 3 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//5//8 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 7 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//5 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 8 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 8 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 1 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 8 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 9 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2 5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 2 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//5 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 10 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 3 2 5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1 3 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 2//3//5 </td>\r\n    \t</tr>\r\n    </tbody>\r\n</table>\r\n-->\r\n\r\n<!-- END: Migrated markdown table -->"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有的数据，有 $1\\le N \\le 10^5$，$N\\le M \\le 10^6$，$0\\le Q \\le 10^5$，$1\\le A_i\\le M$，$C=10$。\r\n\r\n下表展示了某些数据点的一些特殊约束，其中`只有1`表示只有形如`1 x`的操作，其他表述同理。\r\n\r\n<!-- BEGIN: Migrated markdown table -->\r\n\r\n| 测试点编号 | 约束条件 |\r\n|:-:|:-:|\r\n| 1,2,3 | $N,Q\\le 100$ |\r\n| 4,5 | $N,Q\\le 1000$ |\r\n| 6 | $N=M\\le 1000$ |\r\n| 7 | $Q=0$ |\r\n| 8 | 只有0 |\r\n| 9 | 只有1 |\r\n| 10 | 只有2 |\r\n| 11,12 | 只有3 |\r\n| 13 | 只有0和1 |\r\n| 14,15 | 只有0和2 |\r\n| 16 | 只有1和3 |\r\n| 17 | 只有2和3 |\r\n| 18,19,20 | 无限制 |\r\n\r\n<!-- Migrated from original HTML table:\r\n<table class='ui table'>\r\n    <thead>\r\n        <tr>\r\n            <th style='text-align: center'> 测试点编号 </th>\r\n            <th style='text-align: center'> 约束条件 </th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 1,2,3 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> $N,Q\\le 100$ </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 4,5 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> $N,Q\\le 1000$ </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 6 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> $N=M\\le 1000$ </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 7 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> $Q=0$ </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 8 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有0 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 9 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有1 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 10 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有2 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 11,12 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有3 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 13 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有0和1 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 14,15 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有0和2 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 16 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有1和3 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 17 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 只有2和3 </td>\r\n    \t</tr>\r\n    \t<tr>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 18,19,20 </td>\r\n            <td style='text-align: center; border-right: rgba(34, 36, 38, 0.1) 1px solid;'> 无限制 </td>\r\n    \t</tr>\r\n    </tbody>\r\n</table>\r\n-->\r\n\r\n<!-- END: Migrated markdown table -->\r\n\r\n#### 后记\r\n\r\n「奋战两小时，考个四五十」的表情包占领了你的朋友圈：\r\n\r\n- 「啊，感觉自己人生完全了。」\r\n- 「但愿……我真的能拿到四五十。」\r\n- 「我考完了……考完了……完了。」\r\n- 「曾经以为是开玩笑的，原来我还是 *naïve* 了。」\r\n\r\n你冷笑。提前半小时交卷，你自然觉得，数据结构，满分，正常。"}]}