{"title":"「LibreOJ β Round」ZQC 的课堂","time_limit":1000,"memory_limit":512,"tags":["LibreOJ β Round","平衡树","线段树","数据结构"],"operation":{"submit":"https://loj.ac/problem/503#submit_code","submissions":"https://loj.ac/submissions?problem_id=503","statistics":"https://loj.ac/problem/503/statistics/fastest","testdata":"https://loj.ac/problem/503/testdata","discussion":"https://loj.ac/discussion/problem/503"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"叮铃铃 …… 上课铃响了。\r\n\r\n「啊，又是无聊的 math」，坐在教室里的 ZQC 这样想道。Mr.Sam 今天在课上讲了平面直角坐标系上的向量。「这不是幼儿园姿势么」，ZQC 实在忍不住，睡着了。Mr.Sam 把 ZQC 给叫醒，并给了他这样一道题：\r\n\r\n假设有一平面直角坐标系，ZQC 有一支画笔，起点是 $ (1, 1) $，现在有 $n$ 个向量，第 $i$ 个向量形如 $ (x_i, y_i) $，且满足每一个向量都满足 $ x_i, y_i $ 均为偶数。ZQC 按顺序根据这些向量改变自己的画笔的位置，即位置依次改变成 $ (1 + x_1, 1 + y_1), (1 + x_1 + x_2, 1 + y_1 + y_2) \\ldots $。每次改变位置时，画笔都沿两点之间的最短距离移动。结束时，画笔的运动轨迹一定由 $n$ 条线段组成。Mr.Sam 要 ZQC 回答这些线段穿过 $x$ 轴和 $y$ 轴的总次数之和是多少。\r\n\r\n但这样的问题对 ZQC 来说太简单了，于是 Mr.Sam 设定了一个指针，一开始指在第一个向量。现在他做了 $ q(q \\leq 3 \\times 10 ^ 5) $ 个操作，操作有四种，分别是：\r\n\r\n1. $ \\texttt{B} $ 表示把指针向后移动，如果越界则视为无效。即，如果设指针移动前的位置是 $i$，那么移动后的位置是 $\\max(1,i-1)$。\r\n2. $ \\texttt{F} $ 表示把指针向前移动，如果越界则视为无效。即，如果设指针移动前的位置是 $i$，那么移动后的位置是 $\\min(n,i+1)$。\r\n3. $ \\texttt{C} ~ \\text{nx} ~ \\text{ny}$ 把当前指针所指的向量修改为 $(\\text{nx},\\text{ny})$，这里同样满足 $\\text{nx},\\text{ny}$ 为偶数。\r\n4. $ \\texttt{Q} $ 假设 ZQC 从起点开始，按第 $ 1 $ 个到第 $ n(n \\leq 10 ^ 5) $ 个的顺序沿向量走，询问画出的 $n$ 条线段穿过 $x$ 轴和 $y$ 轴次数的总和。\r\n\r\nZQC 想了想，这不是思博题么。\r\n\r\n> 我是要拿图灵奖和菲尔兹奖的男人，这种题浪费我时间，不做！\r\n\r\n但是如果不做的话，ZQC 又会遭到 detention，所以他希望聪明的你能在 $ \\texttt{+1s} $ 内帮他解决这道题。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行一个正整数 $ n $。  \r\n接下来 $ n $ 行每行两个整数 $ x, y $，保证 $ x, y $ 均为偶数。  \r\n接下来一行一个整数 $ q $。  \r\n接下来 $ q $ 行，格式见「题目描述」。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于询问中的每个 $ q $，输出画出的 $ n $ 条线段穿过 $ x $ 轴和 $ y $ 轴次数的总和。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n6\r\n2 2\r\n2 -6\r\n-2 -4\r\n-6 4\r\n10 -10\r\n-8 12\r\n16\r\nQ\r\nC -4 -4 \r\nF\r\nF\r\nQ\r\nF\r\nC 6 -2 \r\nB\r\nB\r\nB\r\nQ\r\nC 0 6 \r\nQ\r\nF\r\nC -8 4 \r\nQ\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n4\r\n4\r\n3\r\n1\r\n5\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"题目中出现的坐标值的绝对值均不超过 $ 500 $。\r\n\r\n因为起点是 $(1,1)$ 而每个向量的每个分量均为偶数，故每次画笔停留的位置横纵坐标均为奇数，不可能在坐标轴上。"}]}