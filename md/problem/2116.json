{"title":"「HNOI2015」开店","time_limit":6000,"memory_limit":512,"tags":["2015","HNOI","树链剖分","点分治","数据结构"],"operation":{"submit":"https://loj.ac/problem/2116#submit_code","submissions":"https://loj.ac/submissions?problem_id=2116","statistics":"https://loj.ac/problem/2116/statistics/fastest","testdata":"https://loj.ac/problem/2116/testdata","discussion":"https://loj.ac/discussion/problem/2116"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"风见幽香有一个好朋友叫八云紫，她们经常一起看星星看月亮从诗词歌赋谈到人生哲学。最近她们灵机一动，打算在幻想乡开一家小店来做生意赚点钱。这样的想法当然非常好啦，但是她们也发现她们面临着一个问题，那就是店开在哪里，面向什么样的人群。\r\n\r\n很神奇的是，幻想乡的地图是一个树形结构，幻想乡一共有 $n$ 个地方，编号为 $1$ 到 $n$，被 $n-1$ 条带权的边连接起来。每个地方都住着一个妖怪，其中第 $i$ 个地方的妖怪年龄是 $x_i$。妖怪都是些比较喜欢安静的家伙，所以它们并不希望和很多妖怪相邻。所以这个树所有顶点的度数都小于或等于 $3$。妖怪和人一样，兴趣点随着年龄的变化自然就会变化，比如我们的 $18$ 岁少女幽香和八云紫就比较喜欢可爱的东西。幽香通过研究发现，基本上妖怪的兴趣只跟年龄有关，所以幽香打算选择一个地方 $u$（$u$ 为编号），然后在 $u$ 开一家面向年龄在 $L$ 到 $R$ 之间（即年龄大于等于 $L$、小于等于 $R$）的妖怪的店。也有可能 $u$ 这个地方离这些妖怪比较远，于是幽香就想要知道所有年龄在 $L$ 到 $R$ 之间的妖怪，到点 $u$ 的距离的和是多少（妖怪到 $u$ 的距离是该妖怪所在地方到 $u$ 的路径上的边的权之和） ，幽香把这个称为这个开店方案的方便值。\r\n\r\n幽香她们还没有决定要把店开在哪里，八云紫倒是准备了很多方案，于是幽香想要知道，对于每个方案，方便值是多少呢。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行三个用空格分开的数 $n,Q,A$，表示树的大小、开店的方案个数和妖怪的年龄上限。\r\n\r\n第二行 $n$ 个用空格分开的数 $x_1,x_2,\\dots,x_n$，$x_i$ 表示第 $i$ 个地点妖怪的年龄，满足 $0 \\le x_i < A$。（年龄是可以为 $0$ 的，例如刚出生的妖怪的年龄为  $0$）\r\n\r\n接下来 $n-1$ 行，每行三个用空格分开的数 $a,b,c$，表示树上的顶点 $a$ 和 $b$ 之间有一条权为 $c$（$1 \\le c \\le 1000$）的边，$a$ 和 $b$ 是顶点编号。\r\n\r\n接下来 $Q$ 行，每行三个用空格分开的数 $u, a, b$。对于这 $Q$ 行的每一行，用 $a, b, A$ 计算出 $L$ 和 $R$，表示询问“在地方 $u$ 开店，面向妖怪的年龄区间为 $[L,R]$ 的方案的方便值是多少”。对于其中第 $1$ 行，$L$ 和 $R$ 的计算方法为：$L=\\min(a\\bmod A,b\\bmod A)$，$R=\\max(a\\bmod A,b\\bmod A)$。对于第 $2$ 到第 $Q$ 行，假设前一行得到的方便值为 $\\mathrm{ans}$，那么当前行的 $L$ 和 $R$ 计算方法为： $L=\\min((a+\\mathrm{ans})\\bmod A,(b+\\mathrm{ans})\\bmod A)$，\r\n$R=\\max((a+\\mathrm{ans})\\bmod A,(b+\\mathrm{ans})\\bmod A)$。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于每个方案，输出一行表示方便值。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n10 10 10 \r\n0 0 7 2 1 4 7 7 7 9  \r\n1 2 270 \r\n2 3 217 \r\n1 4 326 \r\n2 5 361 \r\n4 6 116 \r\n3 7 38 \r\n1 8 800 \r\n6 9 210 \r\n7 10 278 \r\n8 9 8 \r\n2 8 0 \r\n9 3 1 \r\n8 0 8 \r\n4 2 7 \r\n9 7 3 \r\n4 7 0 \r\n2 2 7 \r\n3 2 1 \r\n2 3 4\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n1603 \r\n957 \r\n7161 \r\n9466 \r\n3232 \r\n5223 \r\n1879 \r\n1669 \r\n1282 \r\n0\r\n```"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于所有数据，$n \\le 150000$，$Q \\le 200000$，$A \\le 10^9$。"}]}