{"title":"「SDOI2018」原题识别","time_limit":10000,"memory_limit":512,"tags":["SDOI","2018"],"operation":{"submit":"https://loj.ac/problem/2564#submit_code","submissions":"https://loj.ac/submissions?problem_id=2564","statistics":"https://loj.ac/problem/2564/statistics/fastest","testdata":"https://loj.ac/problem/2564/testdata","discussion":"https://loj.ac/discussion/problem/2564"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"「人肉题库」小 Q 刷题非常勤奋，题量破万。每当有人拿题目请教他时，小 Q 总能在 1 秒内报出这是哪个 OJ 的哪道题。因此，小 Q 是被当作「原题搜索机」一样的存在。\r\n\r\n有一天，小 Q 来到了一棵 $n$ 个节点的有根树下，这棵树的根节点为 $1$ 号点，且每个节点都印着一道题目。凭借超大的题量，小 Q 迅速识别出了每道题的来源，并发现有些题目被搬运了好多次。他把每个节点的题目都做了一个分类，第 $i$ 个节点的题目对应的题目种类为 $a_i$，当且仅当 $a_i=a_j$ 时，$i$ 点和 $j$ 点的题目来源是相同的。\r\n\r\n同一道题目做多次除了增加 AC 数以外，对本身的水平没有任何提高。为了调查这棵树的题目质量，小 Q 会不断提出以下两种询问共 $m$ 次：\r\n\r\n-   ` 1 x y`：如果将 $x$ 点到 $y$ 点的最短路径上的所有点（包括 $x$ 和 $y$）对应的题目都做一遍，那么一共可以做到多少道本质不同的题目？\r\n-    `2 A B`：如果在 $A$ 点到根的最短路径上（包括$A$点和根）等概率随机选择一个点$x$，在 $B$ 点到根的最短路径上(包括 $B$ 点和根)等概率随机选择一个点 $y$，那么询问 `1 x y` 的答案期望是多少？\r\n\r\n定义 $\\text{cnt}_x$ 表示 $x$ 点到根最短路径上的节点个数，因为小 Q 不喜欢分数，而且第 2 类询问的答案一定可以表示成 $\\dfrac{\\text{ans}}{\\text{cnt}_A\\times \\text{cnt}_B}$的形式，你只需要告诉他 $\\text{ans}$ 的值就可以了。\r\n\r\n识别这些题目消耗了小 Q 太大的精力，他没有办法自己去计算这些简单的询问的答案。请写一个程序回答小Q的所有 $m$ 个问题。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行包含一个正整数 $T$，表示测试数据的组数。\r\n\r\n每组数据第一行包含 5 个正整数 $n,p,SA,SB,SC$，其中 $n$ 表示树的节点个数。\r\n\r\n为了在某种程度上减少输入量，树边和每个点的题目种类 $\\texttt{a[]}$ 将由以下代码生成：\r\n\r\n```c\r\nunsigned int SA, SB, SC;\r\nunsigned int rng61(){\r\n    SA ^= SA << 16;\r\n    SA ^= SA >> 5;\r\n    SA ^= SA << 1;\r\n    unsigned int t = SA;\r\n    SA = SB;\r\n    SB = SC;\r\n    SC ^= t ^ SA;\r\n    return SC;\r\n}\r\nvoid gen(){\r\n    scanf(\"%d%d%u%u%u\", &n, &p, &SA, &SB, &SC);\r\n    for(int i = 2; i <= p; i++)\r\n        addedge(i - 1, i);\r\n    for(int i = p + 1; i <= n; i++)\r\n        addedge(rng61() % (i - 1) + 1, i);\r\n    for(int i = 1; i <= n; i++)\r\n        a[i] = rng61() % n + 1;\r\n}\r\n```\r\n\r\n如对生成方式仍有疑问，请参考下发文件中的参考程序。\r\n\r\n第二行包含一个正整数 $m$，表示询问次数。\r\n\r\n接下来 $m$ 行，每行 $3$ 个正整数，形式为 `1 x y` 或者 `2 A B`，依次表示每个询问。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对于每组数据，输出 $m$ 行，每行一个整数，依次回答每个询问。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n2\r\n5 3 10000 12345 54321\r\n3\r\n1 2 3\r\n2 1 3\r\n1 3 2\r\n10 6 23456 77777 55555\r\n5\r\n1 1 10\r\n2 3 5\r\n2 7 5\r\n2 5 4\r\n1 8 6\r\n```\r\n\r\n#### 样例输出 1\r\n```plain\r\n1\r\n5\r\n1\r\n4\r\n34\r\n61\r\n45\r\n3\r\n```\r\n\r\n#### 样例 2\r\n见下发文件。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"$1\\le T\\le 3,2\\le p\\le n\\le 10^5,1\\le m\\le 2\\times 10^5,10^4\\le SA,SB,SC\\le 10^6,1\\le x,y,A,B\\le n$。\r\n\r\n**子任务1（30分）**：只含第1类询问。    \r\n**子任务2（30分）**：满足 $p=n$。   \r\n**子任务3（40分）**：没有任何附加的限制。  "}]}